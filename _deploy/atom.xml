<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

 <title>infoslack.com</title>
 <link href="http://infoslack.com/atom.xml" rel="self"/>
 <link href="http://infoslack.com/"/>
 <updated>2014-05-04T09:26:51-03:00</updated>
 <id>http://infoslack.com/</id>
 <author>
   <name>Daniel Romero</name>
   <email>infoslack@gmail.com</email>
 </author>

 
 <entry>
   <title>Rails, PostgreSQL e o uso de índices</title>
   <link href="http://infoslack.com/development/rails-postgres-e-indices"/>
   <updated>2014-05-03T00:00:00-03:00</updated>
   <id>http://infoslack.com/development/rails-postgres-e-indices</id>
   <content type="html">&lt;h3&gt;Update:&lt;/h3&gt;

&lt;p&gt;&quot;Vale lembrar que campos com índices únicos tratam maiúsculas e minúsculas
como caracteres diferentes. Um campo username com índice único irá aceitar,
por exemplo, os valores &lt;code&gt;john&lt;/code&gt;, &lt;code&gt;John&lt;/code&gt; e &lt;code&gt;JOHN&lt;/code&gt; como valores únicos.
Para evitar que isso aconteça, use a extensão citext.&quot;&lt;/p&gt;

&lt;p&gt;Dica do &lt;a href=&quot;https://twitter.com/fnando&quot;&gt;Nando&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Confira em: &lt;a href=&quot;http://simplesideias.com.br/usando-campos-case-insensitive-no-postgresql&quot;&gt;simplesideias.com.br&lt;/a&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;Ultimamente tenho feito alguns trabalhos que envolvem &quot;melhorias&quot; de software,
ajustes para aumentar o desempenho em produção ou simplesmente para fazer
funcionar da forma correta.&lt;/p&gt;

&lt;p&gt;As melhorias abordam coisas simples como fazer uso correto do ActiveRecord,
utilizar da melhor forma os recursos da tecnologia escolhida. Em boa parte dos
casos o uso de índices e correções no uso do ActiveRecord já resolve bastante.&lt;/p&gt;

&lt;h3&gt;Para que serve um índice ?&lt;/h3&gt;

&lt;p&gt;Em banco de dados, um índice é uma referência utilizada para otimizações, isso
permite que um registro seja localizado de forma mais rápida em uma consulta.&lt;/p&gt;

&lt;p&gt;O PostegreSQL &lt;a href=&quot;http://www.postgresql.org/docs/9.3/static/indexes.html&quot;&gt;possui várias opções de índices&lt;/a&gt;, porém o tipo mais comumente
utilizado é o &lt;a href=&quot;http://en.wikipedia.org/wiki/B-tree&quot;&gt;B-tree&lt;/a&gt;.&lt;/p&gt;

&lt;h3&gt;Índice de chave primária&lt;/h3&gt;

&lt;p&gt;É comum adicionarmos um índice para as chaves primárias de nossas tabelas, mas
no caso do PostgreSQL isso é feito de forma automática, por tanto não precisamos
criar de forma explícita.&lt;/p&gt;

&lt;p&gt;Quando geramos uma migration:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;CreateUser&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ActiveRecord&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Migration&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;change&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;create_table&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:users&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:name&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:email&lt;/span&gt;

      &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;timestamps&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;A saída no psql será a seguinte:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;sql&quot;&gt;&lt;span class=&quot;lineno&quot;&gt; 1&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hfh_development&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=#&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;d&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;users&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 2&lt;/span&gt; 
&lt;span class=&quot;lineno&quot;&gt; 3&lt;/span&gt;                         &lt;span class=&quot;k&quot;&gt;Table&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;quot;public.users&amp;quot;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 4&lt;/span&gt; 
&lt;span class=&quot;lineno&quot;&gt; 5&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;      &lt;span class=&quot;nb&quot;&gt;integer&lt;/span&gt;   &lt;span class=&quot;k&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nextval&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;users_id_seq&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;regclass&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 6&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;    &lt;span class=&quot;nb&quot;&gt;character&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;varying&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;k&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 7&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;email&lt;/span&gt;   &lt;span class=&quot;nb&quot;&gt;character&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;varying&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;k&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 8&lt;/span&gt; 
&lt;span class=&quot;lineno&quot;&gt; 9&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Indexes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;quot;users_pkey&amp;quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;PRIMARY&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;KEY&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;btree&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Na linha 10 podemos ver que o PostgreSQL adicionou o índice B-tree na chave
primária, neste exemplo no campo &lt;code&gt;id&lt;/code&gt;.&lt;/p&gt;

&lt;h3&gt;Aplicações Rails com baixo desempenho por falta de índices&lt;/h3&gt;

&lt;p&gt;Imagine um fórum que possui muitas perguntas organizadas por categorias, sem o
uso de índices a busca seria bastante lenta de ser realizada.
A falta de índices em chaves estrangeiras é um dos problemas mais comuns que
provocam o baixo desempenho em apps Rails.&lt;/p&gt;

&lt;p&gt;O uso de índices em relacionamentos poderia ser dessa forma:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;CreateQuestions&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ActiveRecord&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Migration&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;change&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;create_table&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:questions&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:title&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;text&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:content&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;belongs_to&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:category&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;index&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;

      &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;timestamps&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Ao adicionar &lt;code&gt;index: true&lt;/code&gt; na migration para o relacionamento, o PostgreSQL
gerou um índice chamado &lt;code&gt;index_questions_on_category_id&lt;/code&gt; que aponta para o
campo &lt;code&gt;category_id&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;sql&quot;&gt;&lt;span class=&quot;n&quot;&gt;hfh_development&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=#&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;d&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;questions&lt;/span&gt;

                &lt;span class=&quot;k&quot;&gt;Table&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;quot;public.questions&amp;quot;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;          &lt;span class=&quot;nb&quot;&gt;integer&lt;/span&gt;   &lt;span class=&quot;k&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nextval&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;questions_id_seq&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;regclass&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;title&lt;/span&gt;       &lt;span class=&quot;nb&quot;&gt;character&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;varying&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;k&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;content&lt;/span&gt;     &lt;span class=&quot;nb&quot;&gt;text&lt;/span&gt;                    &lt;span class=&quot;k&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;category_id&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;integer&lt;/span&gt;                 &lt;span class=&quot;k&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;Indexes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;ss&quot;&gt;&amp;quot;questions_pkey&amp;quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;PRIMARY&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;KEY&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;btree&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;ss&quot;&gt;&amp;quot;index_questions_on_category_id&amp;quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;btree&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;category_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Isso faz toda diferença nas consultas feitas pela aplicação.&lt;/p&gt;

&lt;h3&gt;Evitando registros duplicados&lt;/h3&gt;

&lt;p&gt;Pois bem, em alguns dos trabalhos encontrei o problema de registros duplicados
no banco de dados, isso normalmente ocorre por falta do uso de índices para impor
unicidade no valor salvo (apenas validar no Rails não vai resolver o problema).&lt;/p&gt;

&lt;p&gt;Imagine dois usuários tentando fazer um cadastro utilizando o mesmo e-mail e a
sua aplicação possuí apenas o &lt;code&gt;validates_uniqueness_of&lt;/code&gt; no model para validar a
unicidade do e-mail.&lt;/p&gt;

&lt;p&gt;Ao submeterem o formulário preenchido ao mesmo tempo, o Rails vai verificar na
tabela de usuários para saber se já existe algum registro com o e-mail fornecido
, não encontrando nada ele responde que pode prosseguir e acaba permitindo o
registro de 2 e-mails iguais mandando a validação de unicidade pro espaço.&lt;/p&gt;

&lt;p&gt;Para evitar isso, podemos fazer uso de índices de unicidade&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;CreateUser&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ActiveRecord&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Migration&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;change&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;create_table&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:users&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:name&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:email&lt;/span&gt;

      &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;timestamps&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;add_index&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:users&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:email&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;unique&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Adicionando o &lt;code&gt;unique: true&lt;/code&gt; na migration o PostgreSQL irá gerar o seguinte
índice no banco:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;sql&quot;&gt;&lt;span class=&quot;lineno&quot;&gt; 1&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hfh_development&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=#&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;d&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;users&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 2&lt;/span&gt; 
&lt;span class=&quot;lineno&quot;&gt; 3&lt;/span&gt;                         &lt;span class=&quot;k&quot;&gt;Table&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;quot;public.users&amp;quot;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 4&lt;/span&gt; 
&lt;span class=&quot;lineno&quot;&gt; 5&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;      &lt;span class=&quot;nb&quot;&gt;integer&lt;/span&gt;   &lt;span class=&quot;k&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nextval&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;users_id_seq&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;regclass&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 6&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;    &lt;span class=&quot;nb&quot;&gt;character&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;varying&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;k&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 7&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;email&lt;/span&gt;   &lt;span class=&quot;nb&quot;&gt;character&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;varying&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;k&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 8&lt;/span&gt; 
&lt;span class=&quot;lineno&quot;&gt; 9&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Indexes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;quot;users_pkey&amp;quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;PRIMARY&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;KEY&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;btree&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;11&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;quot;index_users_on_email&amp;quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;UNIQUE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;btree&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;email&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Agora é possível garantir a integridade dos dados e evitar a duplicação de
registros.&lt;/p&gt;

&lt;h3&gt;Índices parciais&lt;/h3&gt;

&lt;p&gt;Basicamente um índice parcial é definido por uma expressão condicional, em
outras palavras ele faz uso da cláusula &lt;code&gt;where&lt;/code&gt;, dessa forma ele é construído
apenas com as informações que satisfazem a condição criada.&lt;/p&gt;

&lt;p&gt;Imagine que no aplicativo de fórum temos uma tabela para perguntas e nessa
tabela contém um campo para marcar perguntas como respondidas (true) ou não
respondidas (false), podemos criar um índice parcial para filtrar as não
respondidas e melhorar o desempenho na consulta para exibi-las:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;CreateQuestions&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ActiveRecord&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Migration&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;change&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;create_table&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:questions&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:title&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;text&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:content&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:answered&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt;

      &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;timestamps&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;add_index&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:questions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:answered&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;where&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;answered = false&amp;quot;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;O PostegreSQL vai gerar o seguinte índice:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;sql&quot;&gt;&lt;span class=&quot;n&quot;&gt;hfh_development&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=#&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;d&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;questions&lt;/span&gt;

                &lt;span class=&quot;k&quot;&gt;Table&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;quot;public.questions&amp;quot;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;          &lt;span class=&quot;nb&quot;&gt;integer&lt;/span&gt;   &lt;span class=&quot;k&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nextval&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;questions_id_seq&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;regclass&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;title&lt;/span&gt;       &lt;span class=&quot;nb&quot;&gt;character&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;varying&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;k&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;content&lt;/span&gt;     &lt;span class=&quot;nb&quot;&gt;text&lt;/span&gt;                    &lt;span class=&quot;k&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;answered&lt;/span&gt;    &lt;span class=&quot;nb&quot;&gt;boolean&lt;/span&gt;                 &lt;span class=&quot;k&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;false&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;Indexes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;ss&quot;&gt;&amp;quot;questions_pkey&amp;quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;PRIMARY&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;KEY&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;btree&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;ss&quot;&gt;&amp;quot;index_questions_on_answered&amp;quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;btree&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;questions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;WHERE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;answered&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;false&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Espero que tenha ficado claro a importância do uso de índices.
Happy Hacking ;)&lt;/p&gt;

&lt;h4&gt;Referências&lt;/h4&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://guides.rubyonrails.org/migrations.html&quot;&gt;http://guides.rubyonrails.org/migrations.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.postgresql.org/docs/9.3/static/indexes.html&quot;&gt;http://www.postgresql.org/docs/9.3/static/indexes.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.postgresql.org/docs/9.3/static/indexes-ordering.html&quot;&gt;http://www.postgresql.org/docs/9.3/static/indexes-ordering.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.postgresql.org/docs/9.3/static/indexes-unique.html&quot;&gt;http://www.postgresql.org/docs/9.3/static/indexes-unique.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.postgresql.org/docs/9.3/static/indexes-partial.html&quot;&gt;http://www.postgresql.org/docs/9.3/static/indexes-partial.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

</content>
 </entry>
 
 <entry>
   <title>Gerencie chaves públicas no servidor com gist</title>
   <link href="http://infoslack.com/server/gerencie-chaves-publicas-no-servidor-com-gist"/>
   <updated>2014-03-07T00:00:00-03:00</updated>
   <id>http://infoslack.com/server/gerencie-chaves-publicas-no-servidor-com-gist</id>
   <content type="html">&lt;p&gt;Imagine que você está trabalhando com sua equipe no desenvolvimento de um novo
produto e te pediram para configurar um servidor de testes para rodar o projeto.&lt;/p&gt;

&lt;p&gt;Acontece que após a instalação e configuração do server você recebe o pedido de
um amigo do time para que adicione a chave pública dele no &lt;code&gt;authorized_keys&lt;/code&gt;,
não é incômodo, depois de alguns dias outro amigo faz o mesmo pedido e o primeiro
que te pediu teve que reinstalar o sistema e esqueceu de fazer backup das chaves
e agora a tarefa de atualizar o &lt;code&gt;authorized_keys&lt;/code&gt; começa a virar tortura.&lt;/p&gt;

&lt;p&gt;Pensando nesse problema podemos pedir para que o servidor leia um &lt;a href=&quot;https://gist.github.com/&quot;&gt;gist&lt;/a&gt; com
as informações necessárias para que essa tarefa seja realizada de forma mais
prática.&lt;/p&gt;

&lt;p&gt;Para isso vamos precisar criar um gist de preferência &lt;strong&gt;privado&lt;/strong&gt; com a lista das
chaves públicas de quem deve ser inserido nas configurações como mostra o exemplo:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC5OnYust5S9hwLb4tAtVMOVlRmszam...
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCgRjYuFXqVv1x0WHnNxz3s4doTpx7v...
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCsizI0Nt5wMunAYd2t3daTxnHZBMlW...
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Feito isso vamos ao servidor configurar o &lt;strong&gt;cron&lt;/strong&gt; para que faça a atualização
de forma automática, &lt;code&gt;$ sudo crontab -e&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;powershell&quot;&gt;&lt;span class=&quot;n&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;mkdir&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;-pm&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;700&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;~/.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ssh&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dev&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;curl&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;-s&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;-w&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;\%{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;http_code&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;https&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;//&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gist&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;githubusercontent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;com&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;infoslack&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;867c9e934af23ee8ae6e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;raw&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/\&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;9cde7b86acdda0a3f4d74ee801e4a7bae57f2a08&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;keys_white_list&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;-output&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;~/.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ssh&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;authorized_keys_dl&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dev&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;grep&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;200&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dev&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;mv&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;~/.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ssh&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;authorized_keys_dl&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;~/.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ssh&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;authorized_keys&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;chmod&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;600&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;~/.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ssh&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;authorized_keys&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dev&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;1&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Ok é assustador, mas vamos entender esse comando feio primeiro, estou informando
para o cron que todo dia a meia-noite ele crie o diretório &lt;code&gt;~/.ssh&lt;/code&gt; com a
permissão 700 e caso o diretório já exista que mantenha a sua estrutura, em seguida
estamos redirecionando as mensagens de erro para &lt;code&gt;/dev/null&lt;/code&gt; depois disso o &lt;strong&gt;curl&lt;/strong&gt;
entra em ação pegando as informações no nosso gist e salvando em um arquivo com
o nome de &lt;code&gt;authorized_keys_dl&lt;/code&gt; onde mais uma vez as mensagens de erro são ignoradas,
como passamos um argumento para o &lt;strong&gt;curl&lt;/strong&gt; adicionar ao final do arquivo o status
http da url, fazemos um grep para verificar se está ok, caso não venha esse código
mas um outro como &lt;em&gt;404&lt;/em&gt; a atualização será interrompida.
Depois disso movemos o arquivo baixado para o nome correto &lt;code&gt;authorized_keys&lt;/code&gt; e
alteramos a permissão para 600, sempre enviando o &lt;code&gt;stderr&lt;/code&gt; para &lt;code&gt;/dev/null&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Agora que entendemos o que está sendo feito, vamos melhorar essa instrução.
Podemos elaborar um &lt;em&gt;shell script&lt;/em&gt; bastante reduzido e claro mais legível, mas
antes vamos dar uma olhada em uma feature legal que o github oferece, que é
exibir as chaves públicas dos usuários, simples assim:
&lt;a href=&quot;https://github.com/infoslack.keys&quot;&gt;https://github.com/infoslack.keys&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Dessa forma em vez de manter um gist com todas as chaves públicas, podemos ter
uma lista de usuários, nosso script ficaria assim:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;powershell&quot;&gt;&lt;span class=&quot;c&quot;&gt;#!/bin/sh&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;URL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;RAW_URL_PRIVATE_GIST&amp;quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;TMP&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;/tmp/authorized_keys_dl&amp;quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ERR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;/dev/null 2&amp;gt;&amp;amp;1&amp;quot;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;mkdir&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;-pm&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;700&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;~/.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ssh&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$ERR&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;user&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;curl&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;-silent&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$URL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;curl&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;-s&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;https://github.com/&amp;quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$user&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;.keys&amp;quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;-w&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;\n&amp;quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$TMP&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;done&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;mv&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$TMP&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;~/.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ssh&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;authorized_keys&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;chmod&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;600&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;~/.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ssh&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;authorized_keys&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$ERR&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;E o &lt;em&gt;cron&lt;/em&gt; ficaria assim:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;powershell&quot;&gt;&lt;span class=&quot;n&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;opt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;scripts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;update_authorized_keys&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sh&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;E o gist teria a &lt;strong&gt;whitelist&lt;/strong&gt; dos usuários:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;infoslack
initsec
daniel_romero
...
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;O tempo do cron poderia ser ajustado para intervalos menores ou você poderia
até mesmo fazer algo legal com o monit.&lt;/p&gt;

&lt;p&gt;Happy Hacking ;)&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Automatize tarefas com monit</title>
   <link href="http://infoslack.com/server/automatize-tarefas-com-monit"/>
   <updated>2014-03-06T00:00:00-03:00</updated>
   <id>http://infoslack.com/server/automatize-tarefas-com-monit</id>
   <content type="html">&lt;p&gt;Este é um complemento do &lt;a href=&quot;http://infoslack.com/server/monitore-servicos-e-receba-alertas-com-monit/&quot;&gt;post anterior&lt;/a&gt; sobre monit e veremos como podemos automatizar
tarefas rotineiras.&lt;/p&gt;

&lt;p&gt;No exemplo tenho uma aplicação Ruby on Rails e preciso restartar o meu servidor
de aplicações &lt;a href=&quot;http://unicorn.bogomips.org/&quot;&gt;Unicorn&lt;/a&gt; a cada deploy. Para isso
o monit deve ficar de olho na minha aplicação aguardando que a mesma sofra
alterações após o processo de deploy e em seguida execute uma ação, no nosso
caso reiniciar o &lt;em&gt;Unicorn&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;Tenho um arquivo de &lt;a href=&quot;http://upstart.ubuntu.com/&quot;&gt;upstart&lt;/a&gt; com instruções para inicializar o &lt;em&gt;Unicorn&lt;/em&gt; e
dar o start na minha aplicação:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;powershell&quot;&gt;&lt;span class=&quot;n&quot;&gt;description&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;rails_app server config&amp;quot;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;pre-start&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;script&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;mkdir&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;-p&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;var&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;unicorn&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;chown&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;www-data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;var&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;unicorn&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;mkdir&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;-p&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;var&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;unicorn&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;chown&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;www-data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;var&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;unicorn&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;script&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;start&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;on&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;runlevel&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;23&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;stop&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;on&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;shutdown&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;-u&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;www-data&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sh&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;-c&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;cd /var/www/rails_app/current &amp;amp;&amp;amp; \&lt;/span&gt;
&lt;span class=&quot;s2&quot;&gt;bundle exec unicorn -c /etc/unicorn/rails_app.conf&amp;quot;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;respawn&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Com o &lt;em&gt;upstart&lt;/em&gt; posso executar chamadas para minha aplicação &lt;code&gt;sudo (start|stop|restart) rails_app&lt;/code&gt;
sendo assim, agora posso explicar para o monit o que ele deve fazer.
A cada deploy executado, o comando &lt;code&gt;touch&lt;/code&gt; será executado para criar um arquivo
chamado &lt;em&gt;restart.txt&lt;/em&gt;, sempre que o touch é executado o arquivo gerado sofre
alteração em seu &lt;a href=&quot;http://en.wikipedia.org/wiki/Timestamp&quot;&gt;timestamp&lt;/a&gt; é justamente com base nisso que o monit vai saber
quando executar a ação de restart.&lt;/p&gt;

&lt;p&gt;Nossa configuração do monit ficará assim:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;powershell&quot;&gt;&lt;span class=&quot;n&quot;&gt;check&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;restart&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;txt&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;path&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;var&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;www&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rails_app&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shared&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;restart&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;txt&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;changed&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timestamp&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;then&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;/usr/sbin restart rails_app&amp;quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;O monit vai ficar de olho no arquivo &lt;em&gt;restart.txt&lt;/em&gt; no diretório
&lt;code&gt;/var/www/rails_app/shared&lt;/code&gt; e sempre que ele sofrer alteração em seu timestamp
a cada novo deploy, a ação de restart será executada.&lt;/p&gt;

&lt;p&gt;Happy Hacking ;)&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Monitore serviços e receba alertas com monit</title>
   <link href="http://infoslack.com/server/monitore-servicos-e-receba-alertas-com-monit"/>
   <updated>2014-03-05T00:00:00-03:00</updated>
   <id>http://infoslack.com/server/monitore-servicos-e-receba-alertas-com-monit</id>
   <content type="html">&lt;h3&gt;Introdução&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;http://mmonit.com/monit/&quot;&gt;Monit&lt;/a&gt; é uma ferramenta open source que gerencia e
monitora, aplicações, processos, arquivos, etc em sistemas Unix ou &lt;a href=&quot;http://en.wikipedia.org/wiki/Unix-like&quot;&gt;Unix-like&lt;/a&gt;.
Além disso, &lt;strong&gt;monit&lt;/strong&gt; pode realizar reparos automáticos e executar ações em
ocorrências de erro no sistema, por exemplo, restartar um serviço que teve falha
repentina ou enviar e-mail de alerta avisando sobre algum erro.&lt;/p&gt;

&lt;p&gt;No exemplo a seguir, precisamos monitorar o &lt;a href=&quot;http://nginx.org/&quot;&gt;Nginx&lt;/a&gt; e caso o
serviço seja parado por qualquer motivo o &lt;strong&gt;monit&lt;/strong&gt; deve nos enviar um e-mail
de alerta informando sobre o incidente.&lt;/p&gt;

&lt;h3&gt;Instalação e Configuração&lt;/h3&gt;

&lt;p&gt;No exemplo estou monitorando uma instância Amazon EC2 com Ubuntu 12.04 LTS,
assumindo que o Nginx está instalado e funcionando, vamos ao trabalho:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;sudo apt-get install monit
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;A configuração default do monit fica em &lt;code&gt;/etc/monit&lt;/code&gt;, temos o &lt;code&gt;monitrc&lt;/code&gt; que é
o arquivo de configuração principal e o diretório &lt;code&gt;conf.d&lt;/code&gt; que  armazena as
configurações dos serviços que queremos ficar de olho.&lt;/p&gt;

&lt;p&gt;No nosso exemplo vamos ficar de olho no &lt;em&gt;nginx&lt;/em&gt;, então crie um arquivo chamado
&lt;em&gt;nginx.conf&lt;/em&gt; no diretório &lt;em&gt;conf.d&lt;/em&gt;:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;touch /etc/monit/conf.d/nginx.conf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;A sintaxe do monit é bem simples e muito legível:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;powershell&quot;&gt;&lt;span class=&quot;n&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;alert&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;infoslack&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;@gmail&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;com&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;check&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;host&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;54&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;186&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;55&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;68&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;address&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;54&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;186&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;55&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;68&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;failed&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;host&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;54&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;186&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;55&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;68&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;port&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;80&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;then&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;alert&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;mailserver&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;smtp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gmail&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;com&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;port&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;587&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;username&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;login-gmail&amp;quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;password&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;password&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;using&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tlsv1&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timeout&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;30&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;seconds&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Vamos por partes:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;set alert&lt;/code&gt; estou informando o e-mail onde quero receber os alertas;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;check host&lt;/code&gt; quero que o monit fique verificando o host que pode ser ip/domínio;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;if failed&lt;/code&gt; em caso de falha ele deve executar uma ação, no caso o alerta;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;set mailserver&lt;/code&gt; configura o server de smtp para envio de e-mails;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Gosto de usar o &lt;em&gt;Gmail&lt;/em&gt; para este serviço pois ter um servidor de &lt;em&gt;smtp&lt;/em&gt; próprio
não é uma boa idéia por consumir recursos(processador/memória) do server, além
disso tem o risco do e-mail enviado cair no &lt;em&gt;Spam&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;No exemplo configurei o tempo que o monit leva para fazer a verificação do
&lt;strong&gt;host&lt;/strong&gt;, essa configuração fica em &lt;code&gt;/etc/monit/monitrc&lt;/code&gt; no parâmetro
&lt;code&gt;set daemon&lt;/code&gt;, por default o valor é &lt;em&gt;120&lt;/em&gt; segundos no meu caso deixei em &lt;em&gt;60&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;Depois de tudo configurado, basta testar parando o serviço do &lt;em&gt;nginx&lt;/em&gt;, como
resultado deve chegar um alerta por e-mail informando sobre a falha:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/monit-alert-fail.png&quot; alt=&quot;Alerta monit&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Ao iniciar o &lt;em&gt;nginx&lt;/em&gt; novamente, o monit envia outro alerta avisando que o
serviço está funcionando novamente:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/monit-alert-success.png&quot; alt=&quot;Alerta monit&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Outra configuração poderia ser feita para verificar o &lt;code&gt;PID&lt;/code&gt; do &lt;em&gt;nginx&lt;/em&gt;, ou seja
ficar de olho no processo do serviço e em caso de interrupção o próprio monit
executaria uma ação para iniciar o serviço novamente e alertaria:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;powershell&quot;&gt;&lt;span class=&quot;n&quot;&gt;check&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;process&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nginx&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pidfile&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;var&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nginx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pid&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;start&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;program&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;/etc/init.d/nginx start&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;stop&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;program&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;/etc/init.d/nginx stop&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;failed&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;host&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;54&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;186&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;55&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;68&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;port&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;80&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;then&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;restart&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h3&gt;Finalizando&lt;/h3&gt;

&lt;p&gt;A &lt;a href=&quot;http://mmonit.com/monit/documentation/monit.html&quot;&gt;documentação do monit&lt;/a&gt; é muito rica e vale conferir outras opções como por
exemplo a formatação do layout do e-mail, as informações que serão enviadas no
alerta e até a configuração para utilizar a interface web.&lt;/p&gt;

&lt;p&gt;Use e abuse da criatividade ;)&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Criando uma comunicação segura com OpenVPN</title>
   <link href="http://infoslack.com/security/criando-uma-comunicacao-segura-com-openvpn"/>
   <updated>2014-03-04T00:00:00-03:00</updated>
   <id>http://infoslack.com/security/criando-uma-comunicacao-segura-com-openvpn</id>
   <content type="html">&lt;p&gt;Imagine que você está viajando e que chegando ao hotel a primeira coisa a fazer
foi conectar-se ao Wi-Fi para ler seus e-mails, verificar alguma coisa no internet
banking ou para terminar alguma tarefa pendente.&lt;/p&gt;

&lt;p&gt;O problema é que você nunca sabe quem está conectado na mesma rede, ou o que estão
fazendo na rede. Pode ter alguém capturando os pacotes que trafegam ou pior pode ter
um &lt;a href=&quot;http://en.wikipedia.org/wiki/Packet_analyzer&quot;&gt;sniffer&lt;/a&gt; monitorando todas as
conexões. Mesmo que os serviços que você utilize façam uso de &lt;em&gt;https&lt;/em&gt; é possível
ler os pacotes antes de serem criptografados fazendo uso do: &lt;a href=&quot;https://pypi.python.org/pypi/sslstrip&quot;&gt;SSLstrip&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;A imagem abaixo reflete o cenário onde temos alguém espionando a rede, capturando
as informações que estão trafegando:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/vpn-01.png&quot; alt=&quot;Acesso inseguro&quot; /&gt;&lt;/p&gt;

&lt;p&gt;A proposta para solucionar este problema é de criar uma conexão encapsulada através
de um servidor VPN(&lt;em&gt;Virtual Private Network&lt;/em&gt;), dessa forma é possível mascarar o tráfego
proveniente do nosso computador.&lt;/p&gt;

&lt;p&gt;No exemplo abaixo o tráfego em túnel é uma conexão criptografada que torna impossível
a leitura nítida das informações que trafegam:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/vpn-02.png&quot; alt=&quot;Acesso seguro&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://openvpn.net/&quot;&gt;OpenVPN&lt;/a&gt;, ou (&lt;em&gt;Open Virtual Private Network&lt;/em&gt;) é a ferramenta
que utilizaremos para criar o nosso túnel de rede, ele faz uso do &lt;a href=&quot;https://www.openssl.org/&quot;&gt;OpenSSL&lt;/a&gt;
para criptografar todo o tráfego e fornecer uma conexão segura entre as máquinas,
(cliente/servidor).&lt;/p&gt;

&lt;p&gt;Para esse exemplo, vou utilizar uma VPS com Ubuntu 12.04 LTS.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;123.456.789.12 -&amp;gt; representa o ip da minha máquina local.
111.222.333.44 -&amp;gt; representa o ip da VPS
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Antes de começar, atualize os repositórios e pacotes instalados, em seguida instale
o OpenVPN:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;ubuntu@infoslack:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;sudo apt-get update
ubuntu@infoslack:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;sudo apt-get upgrade
ubuntu@infoslack:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;sudo apt-get install openvpn
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;O OpenVPN possui ferramentas relacionadas à criptografia o &lt;strong&gt;easy-rsa&lt;/strong&gt;, por padrão
encontra-se no diretório &lt;strong&gt;/usr/share/doc/openvpn/examples/easy-rsa/&lt;/strong&gt;, precisamos
dele em &lt;strong&gt;/etc/openvpn&lt;/strong&gt;:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;ubuntu@infoslack:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;sudo cp -R /usr/share/doc/openvpn/examples/easy-rsa/ &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
/etc/openvpn
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Agora, precisamos gerar a infraestrutura de chave pública, entre no diretório
&lt;strong&gt;/etc/openvpn/easy-rsa/2.0/&lt;/strong&gt;, crie um link simbólico chamado &lt;strong&gt;openssl.cnf&lt;/strong&gt; de
&lt;strong&gt;openssl-1.0.0.cnf&lt;/strong&gt;, edite o script &lt;strong&gt;vars&lt;/strong&gt; alterando a linha
&lt;em&gt;export KEY_SIZE=1024&lt;/em&gt; para &lt;em&gt;export KEY_SIZE=2048&lt;/em&gt; pois não queremos gerar chaves
de 1024 bits, por fim execute o script &lt;strong&gt;vars&lt;/strong&gt;:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;ubuntu@infoslack:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /etc/openvpn/easy-rsa/2.0/
ubuntu@infoslack:/etc/openvpn/easy-rsa/2.0&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;sudo ln -s openssl-1.0.0.cnf &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
openssl.cnf
ubuntu@infoslack:/etc/openvpn/easy-rsa/2.0&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;. /etc/openvpn/easy-rsa/2.0/vars
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Após rodar o script &lt;strong&gt;vars&lt;/strong&gt; ele retornará a seguinte mensagem:
&lt;strong&gt;NOTE: If you run ./clean-all, I will be doing a rm -rf on /etc/openvpn/easy-rsa/2.0/keys&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Execute o script &lt;strong&gt;clean-all&lt;/strong&gt; e em seguida o &lt;strong&gt;build-ca&lt;/strong&gt; para gerar os certificados,
preencha as informações que forem solicitadas:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;. /etc/openvpn/easy-rsa/2.0/clean-all
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;. /etc/openvpn/easy-rsa/2.0/build-ca
Generating a 2048 bit RSA private key
.......................................................................+++
.+++
writing new private key to &lt;span class=&quot;s1&quot;&gt;&amp;#39;ca.key&amp;#39;&lt;/span&gt;
-----
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter &lt;span class=&quot;s1&quot;&gt;&amp;#39;.&amp;#39;&lt;/span&gt;, the field will be left blank.
-----
Country Name &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;2 letter code&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;US&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;:
State or Province Name &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;full name&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;CA&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;:
Locality Name &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;eg, city&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;SanFrancisco&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;:
Organization Name &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;eg, company&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Fort-Funston&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;:Infoslack-VPN
Organizational Unit Name &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;eg, section&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;changeme&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;:
Common Name &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;your name or your server hostname&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;changeme&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;:infoslack-server
Name &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;changeme&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;:Admin
Email Address &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;mail@host.domain&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;:root@initsec.com
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Agora basta gerar a chave privada do servidor e o certificado para ser usado em
nosso cliente de VPN, ao criar as chaves, preencha os dados que forem solicitados:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;. /etc/openvpn/easy-rsa/2.0/build-key-server server
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;. /etc/openvpn/easy-rsa/2.0/build-key infoslack-client
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Falta gerar o &lt;strong&gt;Diffie Hellman Parameters&lt;/strong&gt; que é o método utilizado pelo OpenVPN
para troca de chaves, ele irá gerar um arquivo &lt;em&gt;.pem&lt;/em&gt;, essa tarefa demora um pouco:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;. /etc/openvpn/easy-rsa/2.0/build-dh
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Criamos todas as chaves, precisamos movê-las para o local correto:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;ubuntu@infoslack:/etc/openvpn/easy-rsa/2.0&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;keys/
ubuntu@infoslack:/etc/openvpn/easy-rsa/2.0/keys&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;cp ca.crt ca.key &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
server.crt server.key dh2048.pem /etc/openvpn/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Falta pouco, precisamos dos arquivos de configuração que serão utilizados pelo
server e cliente na comunicação:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /usr/share/doc/openvpn/examples/sample-config-files
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;gunzip -d server.conf.gz
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;cp server.conf /etc/openvpn/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Separe os arquivos de cliente para serem enviados a sua máquina:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;mkdir ~/client
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;cp /usr/share/doc/openvpn/examples/sample-config-files/client.conf &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
~/client/
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /etc/openvpn/easy-rsa/2.0/keys/
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;cp ca.crt infoslack-client.crt infoslack-client.key ~/client/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Edite o arquivo de configuração &lt;strong&gt;client.conf&lt;/strong&gt; e altere as informações
referentes ao endereço do server e as chaves:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;#mude para o ip/domínio do servidor:
remote my-server-1 1194 -&amp;gt; 111.222.333.44 1194

#mude para o nome dos arquivos gerados:
dh dh1024.pem -&amp;gt; dh2048.pem
ca ca.crt
cert client.crt -&amp;gt; infoslack-client.crt
key client.key -&amp;gt; infoslack-client.key
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Compacte o diretório com os arquivos de cliente e envie para sua máquina:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;tar -czvf client.tar.gz client/
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;scp client.tar.gz daniel@123.456.789.12:/opt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Antes de inicializar o serviço do OpenVPN no server, vamos criar um
redirecionamento de tráfego da internet para a rede privada da VPN, para isso
edite o arquivo &lt;strong&gt;server.conf&lt;/strong&gt; em &lt;strong&gt;/etc/openvpn&lt;/strong&gt; e descomente a linha:
&lt;code&gt;;push &quot;redirect-gateway def1 bypass-dhcp&quot;&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Crie um script para configurar o iptables e encaminhar o tráfego através da VPN:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;shell-session&quot;&gt;&lt;span class=&quot;go&quot;&gt;echo 1 &amp;gt; /proc/sys/net/ipv4/ip_forward&lt;/span&gt;

&lt;span class=&quot;go&quot;&gt;iptables -A FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT&lt;/span&gt;
&lt;span class=&quot;go&quot;&gt;iptables -A FORWARD -s 10.8.0.0/24 -j ACCEPT&lt;/span&gt;
&lt;span class=&quot;go&quot;&gt;iptables -A FORWARD -j REJECT&lt;/span&gt;
&lt;span class=&quot;go&quot;&gt;iptables -t nat -A POSTROUTING -s 10.8.0.0/24 -o eth0 -j MASQUERADE&lt;/span&gt;
&lt;span class=&quot;go&quot;&gt;iptables -A INPUT -i tun+ -j ACCEPT&lt;/span&gt;
&lt;span class=&quot;go&quot;&gt;iptables -A FORWARD -i tun+ -j ACCEPT&lt;/span&gt;
&lt;span class=&quot;go&quot;&gt;iptables -A INPUT -i tap+ -j ACCEPT&lt;/span&gt;
&lt;span class=&quot;go&quot;&gt;iptables -A FORWARD -i tap+ -j ACCEPT&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Basicamente o script habilita o módulo &lt;strong&gt;ip_forward&lt;/strong&gt; no kernel e cria uma rota
que envia o tráfego de internet da VPS para o nosso túnel criptografado.&lt;/p&gt;

&lt;p&gt;Inicialize o serviço do OpenVPN e execute o script criado:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;sudo service openvpn start
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;sh ~/vpn-route
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Verifique com o comando &lt;strong&gt;ifconfig&lt;/strong&gt; a existência de uma nova interface chamada
&lt;strong&gt;tun0&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Supondo que sua máquina cliente seja linux e com o OpenVPN instalado,
descompacte os arquivos de configuração de client gerados no server e execute:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;mkdir /opt/openvpn
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;tar zxvf /opt/client.tar.gz -C /opt/openvpn
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;openvpn --config /opt/openvpn/client/client.conf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Caso utilize Mac ou Windows verifique as ferramentas &lt;a href=&quot;http://openvpn.se/&quot;&gt;OpenVPN GUI&lt;/a&gt;
e &lt;a href=&quot;https://code.google.com/p/tunnelblick/&quot;&gt;tunnelblick&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Após inicializar o cliente OpenVPN a conexão com a VPN será inicializada e você
receberá uma mensagem informando:
&lt;strong&gt;Initialization Sequence Completed&lt;/strong&gt;, agora podemos testar a nossa conexão com
a VPN e ver se o redirecionamento de tráfego está ok. Para isso utilize o &lt;a href=&quot;https://github.com/kennethreitz/httpbin&quot;&gt;httpbin&lt;/a&gt;:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl httpbin.org/ip
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;s2&quot;&gt;&amp;quot;origin&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;111.222.333.44&amp;quot;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Se o ip retornado for o da sua VPS, significa que o redirecionamento de tráfego
da VPN está funcionando perfeitamente. Outro teste poderia ser feito utilizando o
&lt;a href=&quot;http://ifconfig.me/&quot;&gt;ifconfig.me&lt;/a&gt;:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl ifconfig.me
111.222.333.44
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Com a VPN sua conexão estará um pouco mais segura e você não precisará se
preocupar com as armadilhas das redes wi-fi públicas. =)&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Aumentando a segurança das chaves ssh</title>
   <link href="http://infoslack.com/security/aumentando-a-seguranca-das-chaves-ssh"/>
   <updated>2014-03-03T00:00:00-03:00</updated>
   <id>http://infoslack.com/security/aumentando-a-seguranca-das-chaves-ssh</id>
   <content type="html">&lt;p&gt;Depois de quase 4 anos utilizando um par de chaves DSA de 1024 bits, resolvi
finalmente atualizar para RSA, eu vinha evitando o update por preguiça pois
teria que substituir as chaves em muitos lugares (github, bitbucket, vps, servers...).&lt;/p&gt;

&lt;p&gt;Pois bem, ao criar um par de chaves RSA o OpenSSH por default gera chaves de
2048 bits, não tenho mais certeza se isso é forte o suficiente uma vez que a
&lt;a href=&quot;http://arstechnica.com/security/2013/09/of-course-nsa-can-crack-crypto-anyone-can-the-question-is-how-much/&quot;&gt;NSA pode quebrar chaves RSA de 1024 bits&lt;/a&gt;
em questão de horas, melhor não esperar para saber se mais alguém pode conseguir o mesmo.&lt;/p&gt;

&lt;p&gt;Pensando nisso resolvi gerar novas chaves RSA usando 4096 bits, achei que
ficaria um pouco lento mas não atrapalhou em nada, 2 centésimos de segundo no
meu uso não faz diferença.&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ssh-keygen -t rsa -b 4096
Generating public/private rsa key pair.
Enter file in which to save the key &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;~/.ssh/id_rsa&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;:
Enter passphrase &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;empty &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;no passphrase&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;:
Enter same passphrase again:
Your identification has been saved in ~/.ssh/id_rsa.
Your public key has been saved in ~/.ssh/id_rsa.pub.
The key fingerprint is:
98:50:29:f1:15:1a:42:3c:76:9f:5e:c9:2b:26:ce:8d infoslack@l33t
The keys randomart image is:
+--&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; RSA 4096&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;----+
&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;   o+.o.o.       &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;    &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;+o+         &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;   ..+o. o .     &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;     . oo +      &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;      o.S. .     &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;      . + .      &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;     &lt;span class=&quot;nv&quot;&gt;o&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; .       &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;      E .        &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;                 &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;
+-----------------+
&lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Bem, antes de deixar de usar as antigas chaves DSA e removê-las do sistema de
uma vez, fiz um loop na minha lista de servers para atualizar o &lt;code&gt;authorized_keys&lt;/code&gt;
de cada máquina:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;host in &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;cat ~/.ssh/config &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; grep &lt;span class=&quot;s1&quot;&gt;&amp;#39;^Host &amp;#39;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; sed &lt;span class=&quot;s1&quot;&gt;&amp;#39;s/Host //&amp;#39;&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&amp;gt; &lt;span class=&quot;k&quot;&gt;do &lt;/span&gt;scp ~/configs/authorized_keys &lt;span class=&quot;nv&quot;&gt;$host&lt;/span&gt;:.ssh/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Dessa forma atualizei a chave pública em todos os servers da minha lista, nos
outros serviços tive que fazer manualmente.&lt;/p&gt;

&lt;p&gt;Segue abaixo alguns links para refletir sobre aumentar ou não a segurança de
suas chaves:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://arstechnica.com/security/2013/09/of-course-nsa-can-crack-crypto-anyone-can-the-question-is-how-much/&quot;&gt;Of course NSA can crack crypto.&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://news.techworld.com/security/3214360/rsa-1024-bit-private-key-encryption-cracked/&quot;&gt;RSA 1024-bit private key encryption cracked&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://blog.erratasec.com/2013/09/tor-is-still-dhe-1024-nsa-crackable.html&quot;&gt;Tor is still DHE 1024 (NSA crackable)&lt;/a&gt;&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Conheça o Metasploit Framework</title>
   <link href="http://infoslack.com/security/conheca-o-metasploit-framework"/>
   <updated>2013-11-22T00:00:00-03:00</updated>
   <id>http://infoslack.com/security/conheca-o-metasploit-framework</id>
   <content type="html">&lt;h3&gt;Introdução&lt;/h3&gt;

&lt;p&gt;O &lt;a href=&quot;http://www.metasploit.com/&quot;&gt;Metasploit&lt;/a&gt; é um projeto open source criado
por &lt;a href=&quot;https://twitter.com/hdmoore&quot;&gt;HD Moore&lt;/a&gt; com o objetivo de fornecer um ambiente adequado para o
desenvolvimento, testes de segurança e exploração de vulnerabilidades de
software.&lt;/p&gt;

&lt;p&gt;O projeto nasceu em 2003 com o objetivo de fornecer informações úteis sobre a
realização de testes de invasão e compartilhar algumas ferramentas. O primeiro
release foi lançado oficialmente apenas em 2004 e contava com alguns exploits
escritos em C, Perl e Assembly.&lt;/p&gt;

&lt;p&gt;Quando a versão 3.x foi lançada em 2007 o framework foi quase que totalmente
reescrito em &lt;a href=&quot;https://www.ruby-lang.org/en/&quot;&gt;Ruby&lt;/a&gt;, isso facilitou bastante
a criação de novos exploits e atraiu novos desenvolvedores para o projeto.&lt;/p&gt;

&lt;p&gt;Em 2009 a &lt;a href=&quot;http://www.rapid7.com/&quot;&gt;Rapid7&lt;/a&gt; compra o Metasploit e um ano depois
lança a versão comercial do projeto o &lt;a href=&quot;http://metasploit.pro&quot;&gt;Metasploit Pro&lt;/a&gt;.&lt;/p&gt;

&lt;h3&gt;Arquitetura e Funcionalidades&lt;/h3&gt;

&lt;p&gt;&lt;img src=&quot;/images/msf-arquitetura.png&quot; alt=&quot;Arquitetura do metasploit&quot; /&gt;&lt;/p&gt;

&lt;p&gt;O &lt;strong&gt;REX(Ruby Extension Library)&lt;/strong&gt; é o núcleo do Metasploit, ele disponibiliza
a API com funcionalidades que ajudam no desenvolvimento de um exploit, além de
bibliotecas, sockets e protocolos.&lt;/p&gt;

&lt;p&gt;O &lt;strong&gt;CORE&lt;/strong&gt; do framework é constituído de sub-sistemas que controlam sessões,
módulos, eventos é a API base.&lt;/p&gt;

&lt;p&gt;O &lt;strong&gt;BASE&lt;/strong&gt; fornece uma API amigável e simplifica a comunicação com outros
módulos, interfaces e plugins.&lt;/p&gt;

&lt;p&gt;Na camada &lt;strong&gt;MODULES&lt;/strong&gt; é onde reside os exploits e payloads, basicamente
os exploits são programas escritos para explorar alguma falha e o payload
é como um complemento para o exploit. Basicamente o payload é o código que
vai ser injetado no alvo, ao ser injetado alguma ação pré-definida será
executada, por exemplo: (realizar um download, executar um arquivo, apagar
alguma informação ou estabelecer uma conexão com outro sistema).&lt;/p&gt;

&lt;p&gt;A camada de &lt;strong&gt;INTERFACES&lt;/strong&gt; conta com o modo &lt;strong&gt;console&lt;/strong&gt; onde temos um shell poderoso
que trabalha em conjunto com o SO, o &lt;strong&gt;cli&lt;/strong&gt; que fornece uma interface onde
é possível automatizar testes de invasão e ainda temos interfaces &lt;strong&gt;web&lt;/strong&gt; e &lt;strong&gt;gui&lt;/strong&gt;.&lt;/p&gt;

&lt;h3&gt;Um exemplo prático de uso&lt;/h3&gt;

&lt;p&gt;Vamos à prática e ver um pouco do que é possível fazer com o Metasploit.
Para este exemplo usei como alvo uma máquina com Windows 7 (desatualizada)
e explorei uma falha que permite a execução de código remoto no SO.&lt;/p&gt;

&lt;p&gt;Metasploit em ação:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/msf-console.png&quot; alt=&quot;Metasploit msfconsole&quot; /&gt;&lt;/p&gt;

&lt;p&gt;O exploit usado explora uma vulnerabilidade na manipulação de arquivos do
Windows na criação de um atalho (arquivos .lnk), durante este ataque o metasploit
cria um serviço e espera o alvo acessar a URL para injetar um DLL malicioso no sistema.&lt;/p&gt;

&lt;p&gt;No console do metasploit informo o exploit que irei usar com o comando &lt;code&gt;use&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;msf &amp;gt; use exploit/windows/browser/ms10_046_shortcut_icon_dllloader
msf exploit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ms10_046_shortcut_icon_dllloader&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Em seguida listo as opções oferecidas para a execução do exploit:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/msf-options.png&quot; alt=&quot;show options&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Executando o comando &lt;code&gt;show payloads&lt;/code&gt; o framework irá listar todos os módulos
de payload suportados pelo exploit escolhido, no teste usei o &lt;code&gt;meterpreter&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;O Meterpreter é dos payloads mais poderosos do Metasploit, ele tenta ficar
invisível ao sistema alvo durante um ataque, ou seja ele utiliza recursos para
não ser pego por firewalls ou &lt;strong&gt;IDS(Intrusion Detection System)&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Após escolher o &lt;code&gt;payload&lt;/code&gt; listamos as opções novamente para ver mais recursos,
dessa vez sobre o payload escolhido:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/msf-payload-options.png&quot; alt=&quot;show options payload&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Agora só precisamos setar os parâmetros nas opções de uso do exploit, no caso
apenas 2 são obrigatórias o &lt;code&gt;LHOST&lt;/code&gt; e o &lt;code&gt;SRVHOST&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;As opções &lt;code&gt;SRVHOST&lt;/code&gt; e &lt;code&gt;LHOST&lt;/code&gt; recebem como argumento o ip do host atacante,
sendo a &lt;code&gt;SRVHOST&lt;/code&gt; parâmetro para o exploit e &lt;code&gt;LHOST&lt;/code&gt; parâmetro para o payload.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/msf-set-options.png&quot; alt=&quot;msf set options&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Após as configurações feitas, executamos o exploit:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/msf-run-exploit.png&quot; alt=&quot;msf run exploit&quot; /&gt;&lt;/p&gt;

&lt;p&gt;O metasploit executa um web server nesse momento e aguarda em background que o
alvo acesse a URL &quot;infectada&quot; para injetar o payload e criar uma conexão reversa
com o atacante.&lt;/p&gt;

&lt;p&gt;Enquanto o metasploit fica aguardando, o alvo acessou a URL http://192.168.25.10:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/msf-ataque.png&quot; alt=&quot;msf ataque&quot; /&gt;&lt;/p&gt;

&lt;p&gt;O alerta de segurança no alvo solicita permissão para abrir o conteúdo que
está sendo disponibilizado pelo metasploit, no exemplo um usuário sem atenção
clicou em &lt;code&gt;Permitir&lt;/code&gt;, enquanto isso no console do metasploit o ataque é efetivado
e cada etapa é informada:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/msf-exploit.png&quot; alt=&quot;msf exploiting&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Por fim a conexão reversa é estabelecida ou seja o alvo conectou-se ao atacante,
uma sessão do &lt;code&gt;meterpreter&lt;/code&gt; é aberta e agora podemos entrar no &lt;strong&gt;MS-DOS&lt;/strong&gt; do alvo:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;shell-session&quot;&gt;&lt;span class=&quot;go&quot;&gt;meterpreter &amp;gt;&lt;/span&gt;
&lt;span class=&quot;go&quot;&gt;meterpreter &amp;gt; shell&lt;/span&gt;
&lt;span class=&quot;go&quot;&gt;Process 3180 created.&lt;/span&gt;
&lt;span class=&quot;go&quot;&gt;Channel 1 created.&lt;/span&gt;
&lt;span class=&quot;go&quot;&gt;Microsoft Windows [versão 6.1.7600]&lt;/span&gt;
&lt;span class=&quot;go&quot;&gt;Copyright (c) 2009 Microsoft Corporation. Todos os direitos reservados.&lt;/span&gt;

&lt;span class=&quot;go&quot;&gt;C:\Windows\system32&amp;gt;&lt;/span&gt;

&lt;span class=&quot;go&quot;&gt;C:\&amp;gt;dir&lt;/span&gt;
&lt;span class=&quot;go&quot;&gt;dir&lt;/span&gt;
&lt;span class=&quot;go&quot;&gt; O volume na unidade C não tem nome.&lt;/span&gt;
&lt;span class=&quot;go&quot;&gt; O Número de Série do Volume e 5499-BEB2&lt;/span&gt;

&lt;span class=&quot;go&quot;&gt; Pasta de C:\&lt;/span&gt;

&lt;span class=&quot;go&quot;&gt;10/06/2009  18:42                24 autoexec.bat&lt;/span&gt;
&lt;span class=&quot;go&quot;&gt;10/06/2009  18:42                10 config.sys&lt;/span&gt;
&lt;span class=&quot;go&quot;&gt;13/07/2009  23:37    &amp;lt;DIR&amp;gt;          PerfLogs&lt;/span&gt;
&lt;span class=&quot;go&quot;&gt;23/10/2013  20:07    &amp;lt;DIR&amp;gt;          Program Files&lt;/span&gt;
&lt;span class=&quot;go&quot;&gt;18/11/2012  19:16    &amp;lt;DIR&amp;gt;          Users&lt;/span&gt;
&lt;span class=&quot;go&quot;&gt;17/05/2013  20:21    &amp;lt;DIR&amp;gt;          Windows&lt;/span&gt;
&lt;span class=&quot;go&quot;&gt;               2 arquivo(s)             34 bytes&lt;/span&gt;
&lt;span class=&quot;go&quot;&gt;               4 pasta(s)      996.515.840 bytes disponíveis&lt;/span&gt;

&lt;span class=&quot;go&quot;&gt;C:\&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Simplesmente agora temos acesso total a máquina!&lt;/p&gt;

&lt;h3&gt;Finalizando&lt;/h3&gt;

&lt;p&gt;O &lt;strong&gt;Metasploit&lt;/strong&gt; é uma ferramenta super poderosa e com muitas opções e recursos
para serem explorados, o framework ainda oferece opções para explorar falhas em:
aplicações web, mobile, firmwares, etc.&lt;/p&gt;

&lt;p&gt;Existe uma documentação em forma de tutorial muito completa sobre o metasploit:
&lt;a href=&quot;http://www.offensive-security.com/metasploit-unleashed/Main_Page&quot;&gt;Aqui!&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Acompanhe o projeto no Github: &lt;a href=&quot;https://github.com/rapid7/metasploit-framework&quot;&gt;rapid7/metasploit&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Para mais detalhes sobre a falha explorada no exemplo do post:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://technet.microsoft.com/en-us/security/advisory/2286198&quot;&gt;Microsoft Security Advisory 2286198&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://technet.microsoft.com/en-us/security/bulletin/MS10-046&quot;&gt;MSB-MS10-046&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://cvedetails.com/cve/2010-2568&quot;&gt;CVE-2010-2568&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Esse conteúdo será visto no curso:
&lt;a href=&quot;http://infoslack.com/security/curso-comecando-com-testes-de-invasao/&quot;&gt;Começando com testes de invasão&lt;/a&gt;
com mais detalhes!&lt;/p&gt;

&lt;p&gt;=)&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Introdução ao iptables</title>
   <link href="http://infoslack.com/security/introducao-ao-iptables"/>
   <updated>2013-11-19T00:00:00-03:00</updated>
   <id>http://infoslack.com/security/introducao-ao-iptables</id>
   <content type="html">&lt;h3&gt;O que é o iptables ?&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;http://netfilter.org/&quot;&gt;Netfilter&lt;/a&gt; é o firewall padrão embutido no kernel linux,
sua função é tratar regras aplicadas a pacotes TCP-IP.
O &lt;a href=&quot;http://www.netfilter.org/projects/iptables/&quot;&gt;iptables&lt;/a&gt; nada mais é que uma interface controladora do Netfilter.&lt;/p&gt;

&lt;h3&gt;Entendendo as regras&lt;/h3&gt;

&lt;p&gt;Para gerenciar o tratamento das regras e aplicar aos pacotes o iptables conta
com tabelas e chains.&lt;/p&gt;

&lt;p&gt;As tabelas servem para armazenar as chains. Chains são regras para especificar
o tratamento dos pacotes.&lt;/p&gt;

&lt;p&gt;O iptables possuí 4 tabelas:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;nat&lt;/strong&gt; - tabela padrão usada quando existe comunicação &lt;a href=&quot;http://en.wikipedia.org/wiki/Network_address_translation&quot;&gt;NAT&lt;/a&gt;;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;filter&lt;/strong&gt; - tabela padrão para tráfego de dados comum com NAT;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;mangle&lt;/strong&gt; - tabela para regras especiais de pacotes;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;A tabela &lt;code&gt;filter&lt;/code&gt; é composta pelas seguintes chains:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;INPUT&lt;/strong&gt; - define regras de entrada de pacotes;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;OUTPUT&lt;/strong&gt; - são regras para saída de pacotes;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;FORWARD&lt;/strong&gt; - regras para pacotes que passam pelo firewall;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Já as chains da tabela &lt;code&gt;nat&lt;/code&gt; são:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;PREROUTING&lt;/strong&gt; - regra para processar pacotes antes do roteamento feito pelo firewall;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;POSTROUTING&lt;/strong&gt; - regra para processar pacotes depois do roteamento feito pelo firewall;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;OUTPUT&lt;/strong&gt; - regras para saída de pacotes;
&lt;br&gt;

&lt;h3&gt;Aplicando regras e determinando ações&lt;/h3&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Das opções mais utilizadas para aplicar regras na sintaxe do iptables temos:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;-s&lt;/code&gt; serve para especificar a origem do pacote, EX: &lt;code&gt;-s 192.168.0.1&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-d&lt;/code&gt; serve para especificar o destino do pacote, EX: &lt;code&gt;-d 192.168.0.5&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-i&lt;/code&gt; serve para identificar a interface de entrada do pacote, EX: &lt;code&gt;-i eth0&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-o&lt;/code&gt; serve para identificar a interface de saída do pacote, EX: &lt;code&gt;-o eth1&lt;/code&gt;;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-p&lt;/code&gt; serve para especificar o protocolo usado na regra, EX: &lt;code&gt;-p tcp&lt;/code&gt; ou &lt;code&gt;-p udp&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Para definir as ações usa-se o parâmetro &lt;code&gt;-j&lt;/code&gt;:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ACCEPT&lt;/strong&gt; - aceita o pacote e o processamento da regra é concluído;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;DROP&lt;/strong&gt; - apenas rejeita o pacote;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;REJECT&lt;/strong&gt; - rejeita o pacote e envia um aviso;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;LOG&lt;/strong&gt; - envia mensagem para o &lt;code&gt;syslog&lt;/code&gt; gravando informações sobre pacotes aceitos ou rejeitados;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;As opções são muitas, para ver todas detalhadamente consulte a documentação.&lt;/p&gt;

&lt;p&gt;Ao implementar as regras do firewall podemos e devemos adotar políticas. As políticas
são um conjunto de condições que definem o bloqueio ou a liberação de tráfego de dados.
No caso do iptables o parâmetro &lt;code&gt;-P&lt;/code&gt; define isso.&lt;/p&gt;

&lt;p&gt;No exemplo abaixo estou negando todo o tráfego para as regras de &lt;code&gt;INPUT&lt;/code&gt;, &lt;code&gt;OUTPUT&lt;/code&gt; e
&lt;code&gt;FORWARD&lt;/code&gt; da tabela &lt;code&gt;filter&lt;/code&gt; ou seja estou bloqueando todas as regras para entrada e
saída de pacotes na minha máquina.&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;powershell&quot;&gt;&lt;span class=&quot;n&quot;&gt;iptables&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;-P&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;INPUT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;DROP&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;iptables&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;-P&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OUTPUT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;DROP&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;iptables&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;-P&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FORWARD&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;DROP&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Para verificar regras que foram definidas usamos o parâmetro &lt;code&gt;-L&lt;/code&gt; e para zerar
as regras &lt;code&gt;-R&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;iptables -L
Chain INPUT &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;policy DROP&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
target     prot opt &lt;span class=&quot;nb&quot;&gt;source               &lt;/span&gt;destination

Chain FORWARD &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;policy DROP&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
target     prot opt &lt;span class=&quot;nb&quot;&gt;source               &lt;/span&gt;destination

Chain OUTPUT &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;policy DROP&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
target     prot opt &lt;span class=&quot;nb&quot;&gt;source               &lt;/span&gt;destination
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Testando o firewall, podemos dar um ping na nossa máquina:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ping localhost
PING localhost &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;127.0.0.1&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; 56&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;84&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; bytes of data.
ping: sendmsg: Operation not permitted
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Como a política foi escrita para negar tudo, vamos definir uma exceção para nossa
própria máquina liberando o tráfego de pacotes para a interface &lt;a href=&quot;http://en.wikipedia.org/wiki/Loopback&quot;&gt;loopback&lt;/a&gt;:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;powershell&quot;&gt;&lt;span class=&quot;n&quot;&gt;iptables&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;-A&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OUTPUT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;127&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;-j&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ACCEPT&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;iptables&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;-A&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;INPUT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;127&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;-j&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ACCEPT&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Agora se efetuarmos o mesmo teste anterior é possível obter resposta do ping:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ping localhost
PING localhost &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;127.0.0.1&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; 56&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;84&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; bytes of data.
64 bytes from localhost &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;127.0.0.1&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;: &lt;span class=&quot;nv&quot;&gt;icmp_seq&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1 &lt;span class=&quot;nv&quot;&gt;ttl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;64 &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0.036 ms
64 bytes from localhost &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;127.0.0.1&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;: &lt;span class=&quot;nv&quot;&gt;icmp_seq&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;2 &lt;span class=&quot;nv&quot;&gt;ttl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;64 &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0.043 ms
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Um exemplo de script simples de iptables poderia ser assim:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;powershell&quot;&gt;&lt;span class=&quot;c&quot;&gt;#!/bin/bash&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# definindo política padrão&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;iptables&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;-P&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;INPUT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;DROP&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;iptables&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;-P&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OUTPUT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ACCEPT&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;iptables&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;-P&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FORWARD&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;DROP&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# configurações para regras de entrada&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;iptables&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;-A&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;INPUT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;-i&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lo&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;-j&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ACCEPT&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;iptables&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;-A&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;INPUT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;-p&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;icmp&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;-icmp-type&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;echo-request&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;-m&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;limit&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;-limit&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;-j&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ACCEPT&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;iptables&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;-A&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;INPUT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;-p&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;icmp&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;-icmp-type&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;echo-reply&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;-j&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ACCEPT&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Basicamente as regras de &lt;code&gt;INPUT&lt;/code&gt; e &lt;code&gt;FORWARD&lt;/code&gt; estão bloqueadas e tudo o que sair
da máquina será liberado.&lt;/p&gt;

&lt;h3&gt;Concluindo&lt;/h3&gt;

&lt;p&gt;O que vimos é o básico, uma parte teórica do funcionamento do iptables,
existe uma infinidade de outros comandos e muitas opções que podem ser exploradas.&lt;/p&gt;

&lt;p&gt;Em servidores gosto de soluções mais práticas para configurar o iptables,
como é o caso do &lt;a href=&quot;https://help.ubuntu.com/community/UFW&quot;&gt;UFW (Uncomplicated Firewall)&lt;/a&gt;
que basicamente funciona como uma interface amigável na linha de comando para
gerar as regras do iptables.&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Curso - Começando com testes de invasão</title>
   <link href="http://infoslack.com/security/curso-comecando-com-testes-de-invasao"/>
   <updated>2013-11-08T00:00:00-03:00</updated>
   <id>http://infoslack.com/security/curso-comecando-com-testes-de-invasao</id>
   <content type="html">&lt;h3&gt;Começando com testes de invasão&lt;/h3&gt;

&lt;p&gt;O objetivo do curso é mostrar de forma prática as técnicas e ferramentas utilizadas por
hackers, crackers e profissionais de segurança.
Você vai aprender a realizar testes de invasão explorando falhas em redes,
sistemas operacionais e aplicações web com o objetivo de identificar vulnerabilidades
e quantificar os riscos e nível de exposição.&lt;/p&gt;

&lt;h3&gt;Sobre o instrutor&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;http://infoslack.com/about/&quot;&gt;Daniel Romero&lt;/a&gt; tem mais de 10 anos de experiência com Linux e trabalha com
desenvolvimento de software desde 2006. Foi de PHP e Java, atualmente trabalha com Ruby.&lt;/p&gt;

&lt;p&gt;Autor do livro &quot;&lt;a href=&quot;http://www.casadocodigo.com.br/products/livro-linux&quot;&gt;Começando com o Linux: Comandos, serviços e administração&lt;/a&gt;&quot;.
É também fundador da &lt;a href=&quot;http://www.initsec.com/&quot;&gt;Initsec&lt;/a&gt;, onde oferece serviços com foco em
segurança de aplicações web.&lt;/p&gt;

&lt;h3&gt;O que você vai ver no curso:&lt;/h3&gt;

&lt;p&gt;&lt;br&gt;&lt;/p&gt;

&lt;h4&gt;Segurança da informação&lt;/h4&gt;

&lt;ul&gt;
&lt;li&gt;Princípios básicos&lt;/li&gt;
&lt;li&gt;Tipos de ameaças&lt;/li&gt;
&lt;li&gt;Tipos de ataques&lt;/li&gt;
&lt;li&gt;Proteção&lt;/li&gt;
&lt;li&gt;Serviços
&lt;br&gt;

&lt;h4&gt;Teste de invasão&lt;/h4&gt;&lt;/li&gt;
&lt;li&gt;Escopo do teste&lt;/li&gt;
&lt;li&gt;Tipos de pentest&lt;/li&gt;
&lt;li&gt;Ciclo de um ataque&lt;/li&gt;
&lt;li&gt;Categorias de ataque&lt;/li&gt;
&lt;li&gt;Gerando relatório
&lt;br&gt;

&lt;h4&gt;Levantando informações&lt;/h4&gt;&lt;/li&gt;
&lt;li&gt;Google hacking&lt;/li&gt;
&lt;li&gt;Footprint&lt;/li&gt;
&lt;li&gt;Whois, nslookup, dig&lt;/li&gt;
&lt;li&gt;Entradas DNS&lt;/li&gt;
&lt;li&gt;Engenharia Social
&lt;br&gt;

&lt;h4&gt;Mapeando informações e serviços&lt;/h4&gt;&lt;/li&gt;
&lt;li&gt;Buscando hosts&lt;/li&gt;
&lt;li&gt;Varrendo portas&lt;/li&gt;
&lt;li&gt;Identificando serviços&lt;/li&gt;
&lt;li&gt;Verificando o SO&lt;/li&gt;
&lt;li&gt;nmap, hping3, traceroute
&lt;br&gt;

&lt;h4&gt;Listando vulnerabilidades&lt;/h4&gt;&lt;/li&gt;
&lt;li&gt;Verificando servidores&lt;/li&gt;
&lt;li&gt;Vulnerabilidades em aplicações web&lt;/li&gt;
&lt;li&gt;Testando o SO&lt;/li&gt;
&lt;li&gt;nessus, openvas, nikto, exploitdb, metasploit
&lt;br&gt;

&lt;h4&gt;Explorando vulnerabilidades&lt;/h4&gt;&lt;/li&gt;
&lt;li&gt;Anonimato&lt;/li&gt;
&lt;li&gt;Testando o sistema&lt;/li&gt;
&lt;li&gt;Atacando desktop e servidores&lt;/li&gt;
&lt;li&gt;Atacando aplicações web&lt;/li&gt;
&lt;li&gt;Apagando rastros
&lt;br&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;h3&gt;Pré-requisitos&lt;/h3&gt;

&lt;p&gt;Conhecimentos em Linux, TCP/IP e desenvolvimento web.&lt;/p&gt;

&lt;h3&gt;Informações&lt;/h3&gt;

&lt;p&gt;&lt;strike&gt;O curso será realizado de segunda a sexta: &lt;strong&gt;06/01/14&lt;/strong&gt; a &lt;strong&gt;15/01/14&lt;/strong&gt;&lt;/strike&gt;&lt;/p&gt;

&lt;p&gt;Horário: das &lt;strong&gt;20h às 23h&lt;/strong&gt;, horário de Brasília&lt;/p&gt;

&lt;p&gt;Ambiente: &lt;a href=&quot;http://www.treinatom.com.br/pt/&quot;&gt;TreinaTOM&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Carga horária: &lt;strong&gt;24(horas)&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Valor: &lt;strong&gt;R$ 600,00&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Vagas limitadas!&lt;/p&gt;

&lt;h3&gt;Inscreva-se&lt;/h3&gt;

&lt;p&gt;&lt;strike&gt;Até o dia &lt;strong&gt;25/11/13&lt;/strong&gt; valor promocional de &lt;strong&gt;R$ 520,00&lt;/strong&gt;!&lt;/strike&gt;&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Compilando o Kernel Linux</title>
   <link href="http://infoslack.com/linux/compilando-o-kernel-linux"/>
   <updated>2013-11-04T00:00:00-03:00</updated>
   <id>http://infoslack.com/linux/compilando-o-kernel-linux</id>
   <content type="html">&lt;h3&gt;Motivação&lt;/h3&gt;

&lt;p&gt;Você deve estar se perguntando, por que raios vou querer compilar ou
recompilar o kernel ?&lt;/p&gt;

&lt;p&gt;Bem um dos principais motivos é a otimização, para moldar o kernel de acordo
com o seu hardware, outro bom motivo seria aplicar patches ao kernel para
eliminar bugs. O kernel Linux por default suporta uma infinidade de
dispositivos além de muitos, muitos recursos.&lt;/p&gt;

&lt;p&gt;Um bom exemplo disso é o suporte a rádio amador que vem ativo por padrão:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/kernel-menu.png&quot; alt=&quot;Suporte a rádio amador ativo no kernel&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Além desse exemplo existe ainda uma infinidade de outros módulos que dependendo
do nosso hardware não é utilizado e mesmo assim é carregado no boot.&lt;/p&gt;

&lt;h3&gt;Relembrando os tipos de kernel&lt;/h3&gt;

&lt;p&gt;Antes de prosseguir vamos relembrar os tipos de kernel e entender um pouco
sobre como funciona cada tipo.&lt;/p&gt;

&lt;p&gt;&lt;code&gt;Monolítico&lt;/code&gt; é o kernel que une todos os módulos e subsistemas em um único
arquivo executável. Os módulos apesar de não estarem embutidos no código
do kernel, são executados no espaço de memória usado pelo kernel ou
(kernel space), dessa forma o funcionamento continua sendo centralizado.
Essa característica faz com que esse tipo de kernel seja mais rápido que outros.
O Linux, BSD e FreeBSD são exemplos de kernel monolítico.&lt;/p&gt;

&lt;p&gt;&lt;code&gt;Microkernel&lt;/code&gt; é um kernel modular, grande parte dos subsistemas ficam no
(user space) e se comunicam com o núcleo por meio de mensagens. Esse tipo
de kernel é bastante flexível, Minix e OpenSolaris são exemplos desse
tipo de kernel.&lt;/p&gt;

&lt;p&gt;&lt;code&gt;Híbrido&lt;/code&gt; é uma mistura de kernel monolítico com microkernel, ele mantém
alguns subsistemas em seu núcleo e se comunica com os módulos por troca de
mensagens. Por conta disso, possui desempenho menor. Mac OS e Windows são
exemplos de kernel híbrido.&lt;/p&gt;

&lt;p&gt;Agora que você já relembrou os tipos de kernel e como os módulos são tratados,
podemos continuar!&lt;/p&gt;

&lt;h3&gt;A compilação&lt;/h3&gt;

&lt;p&gt;O primeiro passo para o processo de compilação é o download do código-fonte:
&lt;a href=&quot;https://www.kernel.org/&quot;&gt;kernel.org&lt;/a&gt; vale lembrar que é sempre bom baixar
a versão estável.&lt;/p&gt;

&lt;p&gt;Feito o download, descompacte o kernel no diretório &lt;code&gt;/usr/src&lt;/code&gt; e refaça o
link simbólico existente chamado linux para que ele aponte para o diretório
do seu novo kernel.
Entre no diretório do novo kernel que será compilado e acione a interface
de configuração.&lt;/p&gt;

&lt;p&gt;Veja o exemplo:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /usr/src
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ls
linux@  linux-3.10.17/  linux-3.8.4/
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ls -l linux
lrwxrwxrwx 1 root root 13 Oct 27 15:09 linux -&amp;gt; linux-3.10.17/
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;linux
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;make menuconfig
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;img src=&quot;/images/menuconfig.png&quot; alt=&quot;make menuconfig&quot; /&gt;&lt;/p&gt;

&lt;p&gt;A configuração é a parte mais complexa, aqui você escolhe os módulos que
serão acoplados ao kernel, quais serão ativos e quais não estarão disponíveis.&lt;/p&gt;

&lt;p&gt;Para compilar um kernel do (zero) é preciso obter todas as informações sobre
o hardware, com os comandos &lt;code&gt;lspci&lt;/code&gt;, &lt;code&gt;lscpu&lt;/code&gt;, &lt;code&gt;lsusb&lt;/code&gt; e &lt;code&gt;dmidecode&lt;/code&gt; é possível
obter todas as informações necessárias sobre o hardware para esse processo.&lt;/p&gt;

&lt;p&gt;No menu de configuração temos opções para a escolha dos módulos, &lt;code&gt;[ * ]&lt;/code&gt; indica
que o módulo está habilitado para ser incorporado ao kernel na compilação,
&lt;code&gt;[  ]&lt;/code&gt; desabilitado e &lt;code&gt;[ M ]&lt;/code&gt; ficará habilitado mas não incorporado ao kernel.&lt;/p&gt;

&lt;p&gt;Aqui vamos focar na seguinte situação, você possui uma máquina com uma
distribuição linux instalada e deseja compilar uma versão de kernel mais
atual e de quebra, escolher alguns módulos próprios pro seu hardware.&lt;/p&gt;

&lt;p&gt;Como já temos uma distro instalada e funcionando com o nosso hardware atual,
podemos pegar a atual configuração e utilizar como ponto de partida para a
nova compilação. Para isso utilizamos um arquivo de configuração que existe
no diretório &lt;code&gt;/boot&lt;/code&gt; esse arquivo contém informações sobre os módulos do kernel
que serão carregados durante a inicialização e quais serão ativos por padrão.&lt;/p&gt;

&lt;p&gt;O que deve ser feito é copiar o arquivo de configuração para o diretório do
novo kernel que será compilado para servir de base no processo de escolha de
módulos.&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;cp /boot/config /usr/src/linux/.config
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Após a cópia podemos executar a configuração com &lt;code&gt;make menuconfig&lt;/code&gt;,
de forma automática ele utilizará o arquivo &lt;code&gt;.config&lt;/code&gt; que copiamos de &lt;code&gt;/boot&lt;/code&gt;.
Feito isso, após o menu de configurações ser exibido podemos por exemplo escolher
o nosso modelo de processador e ainda descartar o suporte a outros modelos
fazendo com que o kernel utilize um módulo específico para o hardware em
vez de um módulo genérico.&lt;/p&gt;

&lt;p&gt;&lt;code&gt;Processor type and features&lt;/code&gt; ---&gt; &lt;code&gt;Processor family&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/processor.png&quot; alt=&quot;Processor family&quot; /&gt;&lt;/p&gt;

&lt;p&gt;A opção marcada no exemplo é referente a um modelo de processador Intel,
dessa forma o kernel utilizará o módulo específico em vez do genérico.
Sendo assim no caso do exemplo, poderia ser deabilitado todos os módulos
correspondentes aos processadores AMD.&lt;/p&gt;

&lt;p&gt;Finalizada a configuração basta salvar e partir para a próxima etapa.&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;sudo make bzImage
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Essa é a parte demorada pois depende das escolhas que foram feitas no menu
de módulos e também do hardware. Após concluída com sucesso o novo kernel
estará disponível em &lt;code&gt;/usr/src/linux/arch/x86/boot&lt;/code&gt;, caso seja 64 bits o
diretório será &lt;code&gt;/usr/src/linux/arch/ia64/boot&lt;/code&gt;.
O novo kernel compilado ficará disponível com o nome de &lt;code&gt;bzImage&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Após o fim da compilação do novo kernel é preciso ainda compilar e instalar os
módulos:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;sudo make modules
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;sudo make modules_install
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Depois de instalar os módulos é necessário copiar os novos arquivos gerados
no processo de compilação para o boot, são eles: &lt;code&gt;.config&lt;/code&gt;, &lt;code&gt;System.map&lt;/code&gt; e
o kernel propriamente dito &lt;code&gt;bzImage&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;O &lt;code&gt;System.map&lt;/code&gt; é uma tabela de símbolos do núcleo do sistema que serve de
consulta para verificar os endereços de cada símbolo na memória. Esse arquivo
é recriado a cada nova compilação.&lt;/p&gt;

&lt;p&gt;Copie os arquivos para o &lt;code&gt;/boot&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;cp /usr/src/linux/.config /boot/config
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;cp /usr/src/linux/System.map /boot/System.map
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;cp /usr/src/linux/arch/x86/boot/bzImage /boot/vmlinuz
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;E para finalizar, é preciso ajustar o gerenciador de boot (grub ou lilo)
para que ele carregue o novo kernel que foi compilado.&lt;/p&gt;

&lt;h3&gt;Dicas finais&lt;/h3&gt;

&lt;p&gt;Tudo o que foi mostrado deve funcionar sem problemas em qualquer distribuição
Linux. Você pode optar por automatizar esse processo de compilação criando um
script, no meu caso que uso Slackware mantenho um script como esse:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;powershell&quot;&gt;&lt;span class=&quot;c&quot;&gt;#!/bin/bash&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;VERSION&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;3.11.7&amp;quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;CWD&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;/usr/src&amp;quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$CWD&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;rm&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;usr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;linux&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ln&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;-s&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;usr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;linux&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$VERSION&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;usr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;linux&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$CWD&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;linux&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$VERSION&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;cp&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;boot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;config&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;./.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;make&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;oldconfig&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;make&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bzImage&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;make&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;modules&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;make&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;modules_install&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;boot&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;rm&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vmlinuz&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;map&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;cp&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$CWD&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;linux&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$VERSION&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;config&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$VERSION&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;cp&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$CWD&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;linux&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$VERSION&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;map&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;boot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$VERSION&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;cp&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$CWD&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;linux&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$VERSION&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;arch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x86&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;boot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bzImage&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;boot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;vmlinuz&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$VERSION&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ln&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;-s&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vmlinuz&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$VERSION&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vmlinuz&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ln&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;-s&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$VERSION&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;map&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ln&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;-s&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$VERSION&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;lilo&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Pode ser adaptado para uso em outras distribuições sem complicações.&lt;/p&gt;

&lt;h4&gt;Referências&lt;/h4&gt;

&lt;p&gt;&lt;a href=&quot;http://www.amazon.com/Linux-Kernel-Development-3rd-Edition/dp/0672329468&quot;&gt;Linux Kernel Development (3rd Edition)&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.kroah.com/lkn/&quot;&gt;Linux Kernel in a Nutshell&lt;/a&gt;&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Pssh - Compartilhando o shell de forma fácil</title>
   <link href="http://infoslack.com/shell/pssh-compartilhando-o-shell-de-forma-facil"/>
   <updated>2013-09-21T00:00:00-03:00</updated>
   <id>http://infoslack.com/shell/pssh-compartilhando-o-shell-de-forma-facil</id>
   <content type="html">&lt;p&gt;Já precisou compartilhar rapidamente o shell com um amigo e ficou preso às configurações de SSH e algum multiplexador de terminal?&lt;/p&gt;

&lt;p&gt;E se fosse simples fazer isso enviando apenas uma URL ?&lt;/p&gt;

&lt;h3&gt;Pssh&lt;/h3&gt;

&lt;p&gt;De vez em quando, precisamos compartilhar o shell com alguém de forma rápida, mas esbarramos em tarefas como criar um novo usuário para SSH, liberar porta no Firewall e até configurar algum multiplexador de terminal, como &lt;code&gt;Screen&lt;/code&gt; ou &lt;code&gt;tmux&lt;/code&gt;, e o que deveria ser rápido acaba consumindo um pouco de tempo.&lt;/p&gt;

&lt;p&gt;Pensando nesses problemas, o desenvolvedor &lt;a href=&quot;https://twitter.com/kellymartin&quot;&gt;Kelly Martin&lt;/a&gt; criou o projeto Open Source escrito em &lt;code&gt;Ruby&lt;/code&gt; e &lt;code&gt;JavaScript&lt;/code&gt; chamado &lt;a href=&quot;https://github.com/portly/pssh&quot;&gt;Pssh&lt;/a&gt; para tornar tudo mais fácil.&lt;/p&gt;

&lt;p&gt;O Pssh quando executado, gera uma URL que, quando acessada via browser na porta &lt;code&gt;8022&lt;/code&gt;, permite ou não, a interação com o shell:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/pssh-ex01.png&quot; alt=&quot;Compartilhando shell com Pssh&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Para instalar o Pssh você só vai precisar do Ruby versão 1.9.X ou mais recente:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;gem install pssh
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Opções de uso podem ser vistas com o parâmetro -h:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;pssh -h
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;A opção &lt;code&gt;--readonly&lt;/code&gt; libera uma sessão para somente leitura, não existe interação com o shell:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;pssh --readonly
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;O parâmetro &lt;code&gt;-p&lt;/code&gt; possibilita modificarmos a porta default que é &lt;code&gt;8022&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;pssh -p 5000
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Se você faz uso de algum multiplexador como tmux ou screen, o Pssh pode ser combinado com eles:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/tmux-pssh.png&quot; alt=&quot;Tmux e Pssh&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Contribua com o projeto: &lt;a href=&quot;https://github.com/portly/pssh&quot;&gt;Pssh Github&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Veja um exemplo prático de uso pelo autor: &lt;a href=&quot;http://portly.github.io/pssh/&quot;&gt;Pssh by Portly&lt;/a&gt;&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Manipulando a memória RAM e a SWAP</title>
   <link href="http://infoslack.com/linux/manipulando-a-memoria-ram-e-swap"/>
   <updated>2013-09-21T00:00:00-03:00</updated>
   <id>http://infoslack.com/linux/manipulando-a-memoria-ram-e-swap</id>
   <content type="html">&lt;p&gt;Alguma vez você já precisou limpar o cache da memória RAM ou SWAP no linux ?&lt;/p&gt;

&lt;p&gt;O Linux utiliza o espaço na memória cache para salvar programas e comandos que foram utilizados recentemente, isso permite executá-los mais rapidamente no futuro. É interessante saber manipular esse espaço na memória, vejamos como:&lt;/p&gt;

&lt;h3&gt;Limpando o cache da RAM&lt;/h3&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;sync
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;3 &amp;gt; /proc/sys/vm/drop_caches
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Ou podemos usar o &lt;code&gt;sysctl&lt;/code&gt; para configurar parâmetros de kernel em runtime:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;sysctl vm.drop_caches&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;3
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;br /&gt;
* o &lt;code&gt;sync&lt;/code&gt; faz com que todos os arquivos de cache do sistema sejam descarregados da memória e armazenados em disco, assim não perdemos os dados que estão na RAM
* a opção &lt;code&gt;3&lt;/code&gt; faz o kernel liberar pagecache, dentries e inodes
* outras opções: &lt;code&gt;1&lt;/code&gt; faz o kernel liberar somente pagecache, &lt;code&gt;2&lt;/code&gt; libera inodes e pagecache
* para saber mais: &lt;a href=&quot;http://linux-mm.org/Drop_Caches&quot;&gt;Drop Caches&lt;/a&gt; e &lt;a href=&quot;https://www.kernel.org/doc/Documentation/sysctl/vm.txt&quot;&gt;Sysctl vm&lt;/a&gt;
&lt;br /&gt;&lt;/p&gt;

&lt;h3&gt;Controlando a SWAP&lt;/h3&gt;

&lt;p&gt;É possível configurar e controlar o comportamento da SWAP através de um parâmetro do kernel no arquivo &lt;code&gt;/proc/sys/vm/swappiness&lt;/code&gt;. Este arquivo contém um número de 0 a 100, onde o sistema determina a predisposição para fazer uso da SWAP.&lt;/p&gt;

&lt;p&gt;Um número baixo faz com que ele use a SWAP apenas em situações extremas, enquanto que um número maior aumenta o uso de SWAP e mantém a memória RAM com mais espaço livre.&lt;/p&gt;

&lt;p&gt;Aumentar ou diminuir o uso de SWAP:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;90&amp;quot;&lt;/span&gt; &amp;gt; /proc/sys/vm/swappiness
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;10&amp;quot;&lt;/span&gt; &amp;gt; /proc/sys/vm/swappiness
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ou use o &lt;code&gt;sysctl&lt;/code&gt; para passar esses parâmetros de kernel em runtime&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;sysctl vm.swappiness&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;20
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;No final lembre-se de resetar a SWAP para validar as configurações:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;swapoff -a
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;swapon -a
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;



</content>
 </entry>
 
 <entry>
   <title>Find, liste os arquivos modificados na última hora</title>
   <link href="http://infoslack.com/shell/find-liste-os-arquivos-modificados-na-ultima-hora"/>
   <updated>2013-09-21T00:00:00-03:00</updated>
   <id>http://infoslack.com/shell/find-liste-os-arquivos-modificados-na-ultima-hora</id>
   <content type="html">&lt;p&gt;Usando o &lt;code&gt;find&lt;/code&gt; para listar os arquivos que foram modificados na última hora:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;find . -mtime -1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;o &lt;code&gt;.&lt;/code&gt; é o path para a busca&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-mtime&lt;/code&gt; parâmetro de tempo&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-1&lt;/code&gt; lista os arquivos modificados nas últimas 24 horas&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;strong&gt;Outras configurações:&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;-amin&lt;/code&gt; acessado em minutos&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-atime&lt;/code&gt; acessado em dias&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-cmin&lt;/code&gt; criado em minutos&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-ctime&lt;/code&gt; criado em dias&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-mmin&lt;/code&gt; modificado em minutos&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;strong&gt;E ainda temos parâmetros numéricos:&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;-1&lt;/code&gt; últimas 24 horas&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-0.5&lt;/code&gt; últimas 12 horas&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-0.25&lt;/code&gt; últimas 6 horas&lt;/li&gt;
&lt;li&gt;&lt;code&gt;+3&lt;/code&gt; mais de três dias&lt;/li&gt;
&lt;/ul&gt;

</content>
 </entry>
 
 <entry>
   <title>Meu ambiente de trabalho em 7 itens</title>
   <link href="http://infoslack.com/geral/meu-ambiente-de-trabalho-em-7-itens"/>
   <updated>2013-09-20T00:00:00-03:00</updated>
   <id>http://infoslack.com/geral/meu-ambiente-de-trabalho-em-7-itens</id>
   <content type="html">&lt;p&gt;Voltando a blogar depois de quase 2 anos parado, recomeçando!&lt;br /&gt;
&lt;strong&gt;UPDATE&lt;/strong&gt; nos 7 itens de trabalho =).&lt;/p&gt;

&lt;h3&gt;1 - Linux&lt;/h3&gt;

&lt;p&gt;Há mais de uma década sou usuário Linux, profissionalmente desde 2002.&lt;br /&gt;
Slackware é minha distro favorita e uso em quase todas as máquinas que tenho.&lt;/p&gt;

&lt;p&gt;Se você for um slack user: &lt;a href=&quot;https://github.com/infoslack/slackbuilds&quot;&gt;Meus slackbuilds&lt;/a&gt;&lt;/p&gt;

&lt;h3&gt;2 - Bash&lt;/h3&gt;

&lt;p&gt;Terminal, passo mais de 80% do tempo nele é uma ferramenta que não pode faltar.&lt;br /&gt;
&lt;a href=&quot;https://github.com/infoslack/my_bash&quot;&gt;Minhas configurações para o bash&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Outra ferramenta que estou usando muito é o &lt;a href=&quot;http://tmux.sourceforge.net/&quot;&gt;Tmux&lt;/a&gt;&lt;/p&gt;

&lt;h3&gt;3 - Vim&lt;/h3&gt;

&lt;p&gt;É a minha IDE de desenvolvimento, uso com alguns recursos que o deixa bem interessante.&lt;br /&gt;
&lt;a href=&quot;https://github.com/infoslack/vimfiles&quot;&gt;Minhas configurações para o vim&lt;/a&gt;&lt;/p&gt;

&lt;h3&gt;4 - Git&lt;/h3&gt;

&lt;p&gt;Nunca trabalhei com controle de versão até conhecer o Git, hoje é impossível trabalhar sem.&lt;/p&gt;

&lt;h3&gt;5 - Ruby&lt;/h3&gt;

&lt;p&gt;Programei em PHP e Java, hoje o Ruby faz parte do cotidiano e estamos nos entendendo bem a quase 3 anos.&lt;/p&gt;

&lt;h3&gt;6 - Chrome&lt;/h3&gt;

&lt;p&gt;Gosto do Chrome por conta do Inspect e por ser rápido.&lt;/p&gt;

&lt;h3&gt;7 - IRC&lt;/h3&gt;

&lt;p&gt;Participo de algumas redes e canais que são ótimos para manter bons contatos e aprender algo novo.&lt;br /&gt;
Outros são pura zueira onde as trollagens não tem fim: irc.freenode.net &lt;code&gt;##gurupi&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Esses são os 7 principais itens que uso no dia-a-dia ;)&lt;/p&gt;
</content>
 </entry>
 

</feed>
