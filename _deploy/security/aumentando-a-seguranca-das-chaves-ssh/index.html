<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8">
    <meta name="author" content="Daniel Romero" />
    <meta name="description" content="Aumentando a segurança das chaves ssh"/>
    <meta name="keywords" content="security, hacking, segurança, invasão, server, ssh, keys, openssh"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="google-site-verification" content="-hEvNN86IOrYXeIdV4odleriXAkBE5PAV_Peb2niNZw" />
    <title>Aumentando a segurança das chaves ssh</title>
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href="/css/syntax.css">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
    <script type="text/javascript" src="//use.typekit.net/yed8yuc.js"></script>
    <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
  </head>
  <body>

    <div class="site">
      <div class="header">
        <h1 class="title"><a href="/">root@infoslack:~#</a></h1>
        <a class="extra" href="/">home</a>
        <a class="extra" href="/livro">livro</a>
        <a class="extra" href="/about">about</a>
        <a class="extra" href="http://infoslack.com/atom.xml"><i class="fa fa-rss"></i></a>
      </div>

      <h2>Aumentando a segurança das chaves ssh</h2>
<p class="meta">03/03/2014</p>

<div class="post">
<p>Depois de quase 4 anos utilizando um par de chaves DSA de 1024 bits, resolvi
finalmente atualizar para RSA, eu vinha evitando o update por preguiça pois
teria que substituir as chaves em muitos lugares (github, bitbucket, vps, servers...).</p>

<p>Pois bem, ao criar um par de chaves RSA o OpenSSH por default gera chaves de
2048 bits, não tenho mais certeza se isso é forte o suficiente uma vez que a
<a href="http://arstechnica.com/security/2013/09/of-course-nsa-can-crack-crypto-anyone-can-the-question-is-how-much/">NSA pode quebrar chaves RSA de 1024 bits</a>
em questão de horas, melhor não esperar para saber se mais alguém pode conseguir o mesmo.</p>

<p>Pensando nisso resolvi gerar novas chaves RSA usando 4096 bits, achei que
ficaria um pouco lento mas não atrapalhou em nada, 2 centésimos de segundo no
meu uso não faz diferença.</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>ssh-keygen -t rsa -b 4096
Generating public/private rsa key pair.
Enter file in which to save the key <span class="o">(</span>~/.ssh/id_rsa<span class="o">)</span>:
Enter passphrase <span class="o">(</span>empty <span class="k">for </span>no passphrase<span class="o">)</span>:
Enter same passphrase again:
Your identification has been saved in ~/.ssh/id_rsa.
Your public key has been saved in ~/.ssh/id_rsa.pub.
The key fingerprint is:
98:50:29:f1:15:1a:42:3c:76:9f:5e:c9:2b:26:ce:8d infoslack@l33t
The keys randomart image is:
+--<span class="o">[</span> RSA 4096<span class="o">]</span>----+
<span class="p">|</span>   o+.o.o.       <span class="p">|</span>
<span class="p">|</span>    <span class="o">=</span>+o+         <span class="p">|</span>
<span class="p">|</span>   ..+o. o .     <span class="p">|</span>
<span class="p">|</span>     . oo +      <span class="p">|</span>
<span class="p">|</span>      o.S. .     <span class="p">|</span>
<span class="p">|</span>      . + .      <span class="p">|</span>
<span class="p">|</span>     <span class="nv">o</span> <span class="o">=</span> .       <span class="p">|</span>
<span class="p">|</span>      E .        <span class="p">|</span>
<span class="p">|</span>                 <span class="p">|</span>
+-----------------+
<span class="err">$</span>
</code></pre></div>


<p>Bem, antes de deixar de usar as antigas chaves DSA e removê-las do sistema de
uma vez, fiz um loop na minha lista de servers para atualizar o <code>authorized_keys</code>
de cada máquina:</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span><span class="k">for </span>host in <span class="sb">`</span>cat ~/.ssh/config <span class="p">|</span> grep <span class="s1">&#39;^Host &#39;</span> <span class="p">|</span> sed <span class="s1">&#39;s/Host //&#39;</span><span class="sb">`</span><span class="p">;</span>
&gt; <span class="k">do </span>scp ~/configs/authorized_keys <span class="nv">$host</span>:.ssh/<span class="p">;</span> <span class="k">done</span>
<span class="err">$</span>
</code></pre></div>


<p>Dessa forma atualizei a chave pública em todos os servers da minha lista, nos
outros serviços tive que fazer manualmente.</p>

<p>Segue abaixo alguns links para refletir sobre aumentar ou não a segurança de
suas chaves:</p>

<p><a href="http://arstechnica.com/security/2013/09/of-course-nsa-can-crack-crypto-anyone-can-the-question-is-how-much/">Of course NSA can crack crypto.</a></p>

<p><a href="http://news.techworld.com/security/3214360/rsa-1024-bit-private-key-encryption-cracked/">RSA 1024-bit private key encryption cracked</a></p>

<p><a href="http://blog.erratasec.com/2013/09/tor-is-still-dhe-1024-nsa-crackable.html">Tor is still DHE 1024 (NSA crackable)</a></p>

</div>
<br />
<section class="read-more">
  <h3>Leia também</h3>
  <ul>
    
    <li>
      <span>04/03/2014</span> &raquo;
      <a href="/security/criando-uma-comunicacao-segura-com-openvpn">Criando uma comunicação segura com OpenVPN</a>
    </li>
    
    <li>
      <span>20/09/2013</span> &raquo;
      <a href="/geral/meu-ambiente-de-trabalho-em-7-itens">Meu ambiente de trabalho em 7 itens</a>
    </li>
    
    <li>
      <span>03/05/2014</span> &raquo;
      <a href="/development/rails-postgres-e-indices">Rails, PostgreSQL e o uso de índices</a>
    </li>
    
  </ul>
</section>
<br />
<section>
  <h3>Comentários</h3>
  <div id="disqus_thread" aria-live="polite">
    <script type="text/javascript">
  var disqus_shortname = 'infoslack';

  (function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = 'http://infoslack.disqus.com/embed.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  }());
</script>

  </div>
</section>


      <div class="footer">
        <div class="contact">
          <p>
            Copyright © 2013 - 2014
          </p>
        </div>
      </div>
    </div>
    <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-44190365-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

  </body>
</html>
