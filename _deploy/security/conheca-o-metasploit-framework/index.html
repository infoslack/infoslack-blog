<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8">
    <meta name="author" content="Daniel Romero" />
    <meta name="description" content="Conheça o Metasploit Framework"/>
    <meta name="keywords" content="security, hacking, metasploit, pentest, exploit, segurança, invasão"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="google-site-verification" content="-hEvNN86IOrYXeIdV4odleriXAkBE5PAV_Peb2niNZw" />
    <title>Conheça o Metasploit Framework</title>
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href="/css/syntax.css">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
    <script type="text/javascript" src="//use.typekit.net/yed8yuc.js"></script>
    <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
  </head>
  <body>

    <div class="site">
      <div class="header">
        <h1 class="title"><a href="/">root@infoslack:~#</a></h1>
        <a class="extra" href="/">home</a>
        <a class="extra" href="/livro">livro</a>
        <a class="extra" href="/about">about</a>
        <a class="extra" href="http://infoslack.com/atom.xml"><i class="fa fa-rss"></i></a>
      </div>

      <h2>Conheça o Metasploit Framework</h2>
<p class="meta">22/11/2013</p>

<div class="post">
<h3>Introdução</h3>

<p>O <a href="http://www.metasploit.com/">Metasploit</a> é um projeto open source criado
por <a href="https://twitter.com/hdmoore">HD Moore</a> com o objetivo de fornecer um ambiente adequado para o
desenvolvimento, testes de segurança e exploração de vulnerabilidades de
software.</p>

<p>O projeto nasceu em 2003 com o objetivo de fornecer informações úteis sobre a
realização de testes de invasão e compartilhar algumas ferramentas. O primeiro
release foi lançado oficialmente apenas em 2004 e contava com alguns exploits
escritos em C, Perl e Assembly.</p>

<p>Quando a versão 3.x foi lançada em 2007 o framework foi quase que totalmente
reescrito em <a href="https://www.ruby-lang.org/en/">Ruby</a>, isso facilitou bastante
a criação de novos exploits e atraiu novos desenvolvedores para o projeto.</p>

<p>Em 2009 a <a href="http://www.rapid7.com/">Rapid7</a> compra o Metasploit e um ano depois
lança a versão comercial do projeto o <a href="http://metasploit.pro">Metasploit Pro</a>.</p>

<h3>Arquitetura e Funcionalidades</h3>

<p><img src="/images/msf-arquitetura.png" alt="Arquitetura do metasploit" /></p>

<p>O <strong>REX(Ruby Extension Library)</strong> é o núcleo do Metasploit, ele disponibiliza
a API com funcionalidades que ajudam no desenvolvimento de um exploit, além de
bibliotecas, sockets e protocolos.</p>

<p>O <strong>CORE</strong> do framework é constituído de sub-sistemas que controlam sessões,
módulos, eventos é a API base.</p>

<p>O <strong>BASE</strong> fornece uma API amigável e simplifica a comunicação com outros
módulos, interfaces e plugins.</p>

<p>Na camada <strong>MODULES</strong> é onde reside os exploits e payloads, basicamente
os exploits são programas escritos para explorar alguma falha e o payload
é como um complemento para o exploit. Basicamente o payload é o código que
vai ser injetado no alvo, ao ser injetado alguma ação pré-definida será
executada, por exemplo: (realizar um download, executar um arquivo, apagar
alguma informação ou estabelecer uma conexão com outro sistema).</p>

<p>A camada de <strong>INTERFACES</strong> conta com o modo <strong>console</strong> onde temos um shell poderoso
que trabalha em conjunto com o SO, o <strong>cli</strong> que fornece uma interface onde
é possível automatizar testes de invasão e ainda temos interfaces <strong>web</strong> e <strong>gui</strong>.</p>

<h3>Um exemplo prático de uso</h3>

<p>Vamos à prática e ver um pouco do que é possível fazer com o Metasploit.
Para este exemplo usei como alvo uma máquina com Windows 7 (desatualizada)
e explorei uma falha que permite a execução de código remoto no SO.</p>

<p>Metasploit em ação:</p>

<p><img src="/images/msf-console.png" alt="Metasploit msfconsole" /></p>

<p>O exploit usado explora uma vulnerabilidade na manipulação de arquivos do
Windows na criação de um atalho (arquivos .lnk), durante este ataque o metasploit
cria um serviço e espera o alvo acessar a URL para injetar um DLL malicioso no sistema.</p>

<p>No console do metasploit informo o exploit que irei usar com o comando <code>use</code>:</p>

<div class="highlight"><pre><code class="bash">msf &gt; use exploit/windows/browser/ms10_046_shortcut_icon_dllloader
msf exploit<span class="o">(</span>ms10_046_shortcut_icon_dllloader<span class="o">)</span> &gt;
</code></pre></div>


<p>Em seguida listo as opções oferecidas para a execução do exploit:</p>

<p><img src="/images/msf-options.png" alt="show options" /></p>

<p>Executando o comando <code>show payloads</code> o framework irá listar todos os módulos
de payload suportados pelo exploit escolhido, no teste usei o <code>meterpreter</code>.</p>

<p>O Meterpreter é dos payloads mais poderosos do Metasploit, ele tenta ficar
invisível ao sistema alvo durante um ataque, ou seja ele utiliza recursos para
não ser pego por firewalls ou <strong>IDS(Intrusion Detection System)</strong>.</p>

<p>Após escolher o <code>payload</code> listamos as opções novamente para ver mais recursos,
dessa vez sobre o payload escolhido:</p>

<p><img src="/images/msf-payload-options.png" alt="show options payload" /></p>

<p>Agora só precisamos setar os parâmetros nas opções de uso do exploit, no caso
apenas 2 são obrigatórias o <code>LHOST</code> e o <code>SRVHOST</code>.</p>

<p>As opções <code>SRVHOST</code> e <code>LHOST</code> recebem como argumento o ip do host atacante,
sendo a <code>SRVHOST</code> parâmetro para o exploit e <code>LHOST</code> parâmetro para o payload.</p>

<p><img src="/images/msf-set-options.png" alt="msf set options" /></p>

<p>Após as configurações feitas, executamos o exploit:</p>

<p><img src="/images/msf-run-exploit.png" alt="msf run exploit" /></p>

<p>O metasploit executa um web server nesse momento e aguarda em background que o
alvo acesse a URL "infectada" para injetar o payload e criar uma conexão reversa
com o atacante.</p>

<p>Enquanto o metasploit fica aguardando, o alvo acessou a URL http://192.168.25.10:</p>

<p><img src="/images/msf-ataque.png" alt="msf ataque" /></p>

<p>O alerta de segurança no alvo solicita permissão para abrir o conteúdo que
está sendo disponibilizado pelo metasploit, no exemplo um usuário sem atenção
clicou em <code>Permitir</code>, enquanto isso no console do metasploit o ataque é efetivado
e cada etapa é informada:</p>

<p><img src="/images/msf-exploit.png" alt="msf exploiting" /></p>

<p>Por fim a conexão reversa é estabelecida ou seja o alvo conectou-se ao atacante,
uma sessão do <code>meterpreter</code> é aberta e agora podemos entrar no <strong>MS-DOS</strong> do alvo:</p>

<div class="highlight"><pre><code class="shell-session"><span class="go">meterpreter &gt;</span>
<span class="go">meterpreter &gt; shell</span>
<span class="go">Process 3180 created.</span>
<span class="go">Channel 1 created.</span>
<span class="go">Microsoft Windows [versão 6.1.7600]</span>
<span class="go">Copyright (c) 2009 Microsoft Corporation. Todos os direitos reservados.</span>

<span class="go">C:\Windows\system32&gt;</span>

<span class="go">C:\&gt;dir</span>
<span class="go">dir</span>
<span class="go"> O volume na unidade C não tem nome.</span>
<span class="go"> O Número de Série do Volume e 5499-BEB2</span>

<span class="go"> Pasta de C:\</span>

<span class="go">10/06/2009  18:42                24 autoexec.bat</span>
<span class="go">10/06/2009  18:42                10 config.sys</span>
<span class="go">13/07/2009  23:37    &lt;DIR&gt;          PerfLogs</span>
<span class="go">23/10/2013  20:07    &lt;DIR&gt;          Program Files</span>
<span class="go">18/11/2012  19:16    &lt;DIR&gt;          Users</span>
<span class="go">17/05/2013  20:21    &lt;DIR&gt;          Windows</span>
<span class="go">               2 arquivo(s)             34 bytes</span>
<span class="go">               4 pasta(s)      996.515.840 bytes disponíveis</span>

<span class="go">C:\&gt;</span>
</code></pre></div>


<p>Simplesmente agora temos acesso total a máquina!</p>

<h3>Finalizando</h3>

<p>O <strong>Metasploit</strong> é uma ferramenta super poderosa e com muitas opções e recursos
para serem explorados, o framework ainda oferece opções para explorar falhas em:
aplicações web, mobile, firmwares, etc.</p>

<p>Existe uma documentação em forma de tutorial muito completa sobre o metasploit:
<a href="http://www.offensive-security.com/metasploit-unleashed/Main_Page">Aqui!</a></p>

<p>Acompanhe o projeto no Github: <a href="https://github.com/rapid7/metasploit-framework">rapid7/metasploit</a></p>

<p>Para mais detalhes sobre a falha explorada no exemplo do post:</p>

<ul>
<li><a href="http://technet.microsoft.com/en-us/security/advisory/2286198">Microsoft Security Advisory 2286198</a></li>
<li><a href="http://technet.microsoft.com/en-us/security/bulletin/MS10-046">MSB-MS10-046</a></li>
<li><a href="http://cvedetails.com/cve/2010-2568">CVE-2010-2568</a></li>
</ul>


<p>Esse conteúdo será visto no curso:
<a href="http://infoslack.com/security/curso-comecando-com-testes-de-invasao/">Começando com testes de invasão</a>
com mais detalhes!</p>

<p>=)</p>

</div>
<br />
<section class="read-more">
  <h3>Leia também</h3>
  <ul>
    
    <li>
      <span>04/11/2013</span> &raquo;
      <a href="/linux/compilando-o-kernel-linux">Compilando o Kernel Linux</a>
    </li>
    
    <li>
      <span>04/03/2014</span> &raquo;
      <a href="/security/criando-uma-comunicacao-segura-com-openvpn">Criando uma comunicação segura com OpenVPN</a>
    </li>
    
    <li>
      <span>19/11/2013</span> &raquo;
      <a href="/security/introducao-ao-iptables">Introdução ao iptables</a>
    </li>
    
  </ul>
</section>
<br />
<section>
  <h3>Comentários</h3>
  <div id="disqus_thread" aria-live="polite">
    <script type="text/javascript">
  var disqus_shortname = 'infoslack';

  (function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = 'http://infoslack.disqus.com/embed.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  }());
</script>

  </div>
</section>


      <div class="footer">
        <div class="contact">
          <p>
            Copyright © 2013 - 2014
          </p>
        </div>
      </div>
    </div>
    <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-44190365-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

  </body>
</html>
